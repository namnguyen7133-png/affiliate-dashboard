<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·ªô L·ªçc S·∫£n Ph·∫©m Kim T·ª© ƒê·ªì - Nam Nguy·ªÖn</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { color: #ee4d2d; text-align: center; text-transform: uppercase; }
        .filter-box { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; background: #fff5f2; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        label { font-weight: bold; font-size: 13px; color: #555; display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        button { background: #ee4d2d; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #d73d1d; transform: translateY(-2px); }
        
        .stats-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #333; color: white; padding: 15px; border-radius: 10px; flex: 1; text-align: center; }
        .stat-card span { display: block; font-size: 20px; font-weight: bold; color: #ffbe00; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th { background: #ee4d2d; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background: #fff9f8; }
        .price { color: #2ecc71; font-weight: bold; }
        .comm { color: #ee4d2d; font-weight: bold; }
        .sales { background: #fff0eb; color: #ee4d2d; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .btn-link { background: #0066cc; color: white; text-decoration: none; padding: 5px 10px; border-radius: 5px; font-size: 11px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üöÄ TR√çCH XU·∫§T SI√äU PH·∫®M SHOPEE</h2>
    
    <div class="filter-box">
        <div>
            <label>1. Ch·ªçn t·ªáp CSV (B√°o c√°o s·∫£n ph·∫©m):</label>
            <input type="file" id="csvFile" accept=".csv">
        </div>
        <div>
            <label>2. Hoa h·ªìng m·ª•c ti√™u:</label>
            <select id="rangeHH">
                <option value="all">T·∫•t c·∫£ m·ª©c</option>
                <option value="8">D∆∞·ªõi 8%</option>
                <option value="12">D∆∞·ªõi 12%</option>
                <option value="15">D∆∞·ªõi 15%</option>
                <option value="20">D∆∞·ªõi 20%</option>
            </select>
        </div>
        <div>
            <label>3. Doanh s·ªë t·ªëi thi·ªÉu:</label>
            <select id="minSales">
                <option value="0">T·∫•t c·∫£</option>
                <option value="10">T·ª´ 10k+ b√°n</option>
                <option value="50">T·ª´ 50k+ b√°n</option>
                <option value="100">T·ª´ 100k+ b√°n</option>
            </select>
        </div>
    </div>

    <button onclick="processData()">PH√ÇN T√çCH V√Ä L·ªåC D·ªÆ LI·ªÜU</button>

    <div id="stats" class="stats-container" style="display:none; margin-top:20px;">
        <div class="stat-card">T·ªïng s·∫£n ph·∫©m<span id="totalItems">0</span></div>
        <div class="stat-card">M√≥n "Kh·ªßng" (>100k b√°n)<span id="hotItems">0</span></div>
        <div class="stat-card">HH cao (>15%)<span id="highComm">0</span></div>
    </div>

    <table id="resultTable" style="display:none;">
        <thead>
            <tr>
                <th>T√™n s·∫£n ph·∫©m</th>
                <th>Gi√°</th>
                <th>ƒê√£ b√°n</th>
                <th>Hoa h·ªìng</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>
</div>

<script>
    function parseCSV(text) {
        const rows = [];
        let currentRow = [];
        let currentField = '';
        let inQuotes = false;

        for (let i = 0; i < text.length; i++) {
            let char = text[i];
            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                currentRow.push(currentField.trim());
                currentField = '';
            } else if ((char === '\r' || char === '\n') && !inQuotes) {
                if (currentField || currentRow.length > 0) {
                    currentRow.push(currentField.trim());
                    rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                }
            } else {
                currentField += char;
            }
        }
        return rows;
    }

    function processData() {
        const fileInput = document.getElementById('csvFile');
        const hhLimit = document.getElementById('rangeHH').value;
        const saleLimit = parseInt(document.getElementById('minSales').value);
        
        if (!fileInput.files[0]) return alert("Vui l√≤ng ch·ªçn file CSV!");

        const reader = new FileReader();
        reader.onload = function(e) {
            const data = parseCSV(e.target.result);
            let html = '';
            let total = 0, hot = 0, high = 0;

            data.forEach((cols, i) => {
                if (i === 0 || cols.length < 8) return;

                // C·ªôt: 1: T√™n, 2: Gi√°, 3: Doanh thu, 5: % HH, 8: Link ∆∞u ƒë√£i
                const name = cols[1];
                const price = cols[2];
                const salesStr = cols[3].toLowerCase();
                const hhStr = cols[5].replace('%', '').replace(',', '.');
                const hh = parseFloat(hhStr);
                const link = cols[8];

                // Chuy·ªÉn ƒë·ªïi s·ªë b√°n (v√≠ d·ª• "10k+" -> 10)
                let salesVal = 0;
                if (salesStr.includes('k')) salesVal = parseFloat(salesStr.replace('k+', ''));
                else salesVal = parseFloat(salesStr) / 1000;

                // Th·ªëng k√™
                total++;
                if (salesVal >= 100) hot++;
                if (hh >= 15) high++;

                // L·ªçc
                let hhMatch = (hhLimit === "all") || (hh < parseFloat(hhLimit));
                let saleMatch = salesVal >= saleLimit;

                if (hhMatch && saleMatch) {
                    html += `<tr>
                        <td>${name.substring(0, 50)}...</td>
                        <td class="price">${price}</td>
                        <td><span class="sales">${cols[3]}</span></td>
                        <td class="comm">${hh}%</td>
                        <td><a href="${link}" target="_blank" class="btn-link">L·∫•y Link</a></td>
                    </tr>`;
                }
            });

            document.getElementById('totalItems').innerText = total;
            document.getElementById('hotItems').innerText = hot;
            document.getElementById('highComm').innerText = high;
            document.getElementById('stats').style.display = 'flex';
            document.getElementById('resultBody').innerHTML = html;
            document.getElementById('resultTable').style.display = 'table';
        };
        reader.readAsText(fileInput.files[0]);
    }
</script>

</body>
</html>