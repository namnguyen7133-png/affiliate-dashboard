<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng T√°c Chi·∫øn Affiliate To√†n NƒÉng - Nam Nguy·ªÖn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --shopee: #ee4d2d; --front: #ef4444; --back: #10b981; --storage: #f59e0b;
            --bg: #f4f7f6; --dark: #333;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR CHI·∫æN THU·∫¨T (015) */
        .sidebar { width: 280px; background: white; border-right: 1px solid #e0e0e0; overflow-y: auto; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .step { padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid #ccc; opacity: 0.5; font-size: 12px; transition: 0.3s; }
        .step.active { opacity: 1; transform: scale(1.03); box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-left-width: 8px; }
        .step.morning { border-left-color: var(--back); }
        .step.noon { border-left-color: var(--storage); }
        .step.afternoon { border-left-color: var(--front); }

        /* MAIN CONTENT */
        .main-content { flex: 1; overflow-y: auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* TH·ªêNG K√ä SI√äU PH·∫®M (M·∫£nh m·ªõi nh·∫•t) */
        .stats-grid { display: flex; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--dark); color: white; padding: 15px; border-radius: 12px; flex: 1; text-align: center; border-bottom: 4px solid var(--shopee); }
        .stat-card span { display: block; font-size: 22px; font-weight: bold; color: #ffbe00; margin-top: 5px; }

        /* B·ªò L·ªåC ƒêA T·∫¶NG */
        .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; background: #fff5f2; padding: 20px; border-radius: 12px; }
        label { font-weight: bold; font-size: 12px; color: #666; display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; }
        
        .btn-action { background: var(--shopee); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 15px; transition: 0.3s; }
        .btn-action:hover { background: #d73d1d; transform: translateY(-2px); }

        /* B·∫¢NG K·∫æT QU·∫¢ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th { background: #f8f9fa; padding: 12px; text-align: left; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .price { color: #2ecc71; font-weight: bold; }
        .sales-badge { background: #fff0eb; color: var(--shopee); padding: 3px 8px; border-radius: 4px; font-weight: bold; }
        .btn-link { background: #0066cc; color: white; text-decoration: none; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; }

        /* CRM MINI (014) */
        .crm-bar { display: flex; justify-content: space-between; align-items: center; background: var(--back); color: white; padding: 10px 20px; border-radius: 10px; margin-bottom: 20px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3 style="margin-top:0"><i class="fas fa-rocket"></i> L·ªô Tr√¨nh 24H</h3>
        <div id="step1" class="step morning"><b>08:00</b> - H·∫≠u ph∆∞∆°ng: Soi b√†i</div>
        <div id="step2" class="step noon"><b>10:00</b> - Kho l∆∞∆°ng: L·ªçc h√†ng</div>
        <div id="step3" class="step afternoon"><b>14:00</b> - Ti·ªÅn tuy·∫øn: L√™n k·ªá</div>
        <div id="step4" class="step afternoon"><b>19:00</b> - Chi·∫øn tr∆∞·ªùng: N·ªï ƒë∆°n</div>
        <hr>
        <div style="font-size: 11px; color: #888; line-height: 1.6;">
            <b>Ghi ch√∫:</b> T·∫≠p trung v√†o c√°c s·∫£n ph·∫©m c√≥ s·ªë b√°n >10k (Hot Items) ƒë·ªÉ tƒÉng t·ª∑ l·ªá click-to-buy.
        </div>
    </div>

    <div class="main-content">
        
        <div class="crm-bar">
            <span><i class="fas fa-heart"></i> ƒê√£ chƒÉm s√≥c: <b id="custCount">0</b>/20 kh√°ch ng∆∞·ªùi quen</span>
            <button onclick="addCust()" style="background:white; color:var(--back); border:none; padding:5px 12px; border-radius:6px; cursor:pointer; font-weight:bold">+1 Kh√°ch</button>
        </div>

        <div class="card">
            <h2 style="color:var(--shopee); margin-top:0"><i class="fas fa-filter"></i> TR√çCH XU·∫§T SI√äU PH·∫®M</h2>
            
            <div class="filter-grid">
                <div style="grid-column: span 2;">
                    <label>1. T·ªáp CSV (B√°o c√°o Shopee):</label>
                    <input type="file" id="csvFile" accept=".csv">
                </div>
                <div>
                    <label>2. T·∫ßng Kim T·ª© ƒê·ªì:</label>
                    <select id="tierFilter">
                        <option value="all">T·∫•t c·∫£ gi√°</option>
                        <option value="L">L (<200k)</option>
                        <option value="T">T (200k-1tr)</option>
                        <option value="C">C (1tr-5tr)</option>
                        <option value="D">D (>5tr)</option>
                    </select>
                </div>
                <div>
                    <label>3. Hoa h·ªìng Max:</label>
                    <select id="hhLimit">
                        <option value="100">T·∫•t c·∫£</option>
                        <option value="8">D∆∞·ªõi 8%</option>
                        <option value="12">D∆∞·ªõi 12%</option>
                        <option value="15">D∆∞·ªõi 15%</option>
                    </select>
                </div>
                <div>
                    <label>4. S·ªë b√°n t·ªëi thi·ªÉu:</label>
                    <select id="minSales">
                        <option value="0">T·∫•t c·∫£</option>
                        <option value="10">T·ª´ 10k+ b√°n</option>
                        <option value="50">T·ª´ 50k+ b√°n</option>
                        <option value="100">T·ª´ 100k+ b√°n</option>
                    </select>
                </div>
            </div>
            
            <button class="btn-action" onclick="processData()">B·∫ÆT ƒê·∫¶U PH√ÇN T√çCH D·ªÆ LI·ªÜU</button>
        </div>

        <div id="stats" class="stats-container stats-grid" style="display:none;">
            <div class="stat-card">T·ªïng s·∫£n ph·∫©m <span id="totalItems">0</span></div>
            <div class="stat-card">Si√™u ph·∫©m (>100k b√°n) <span id="hotItems">0</span></div>
            <div class="stat-card">HH cao (>15%) <span id="highComm">0</span></div>
        </div>

        <div class="card">
            <h3 style="margin-top:0"><i class="fas fa-list-ul"></i> K·∫øt Qu·∫£ L·ªçc Chi Ti·∫øt</h3>
            <table id="resultTable" style="display:none;">
                <thead>
                    <tr>
                        <th>T√™n s·∫£n ph·∫©m</th>
                        <th>Gi√°</th>
                        <th>ƒê√£ b√°n</th>
                        <th>Hoa h·ªìng</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="resultBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let customers = parseInt(localStorage.getItem('cust_count')) || 0;
        document.getElementById('custCount').innerText = customers;

        const priceTiers = {
            'L': [0, 200000], 'T': [200001, 1000000], 
            'C': [1000001, 5000000], 'D': [5000001, 999999999], 'all': [0, 999999999]
        };

        // H√†m parse chu·∫©n (x·ª≠ l√Ω ngo·∫∑c k√©p)
        function parseCSV(text) {
            const rows = [];
            let curField = '', inQuotes = false, currentRow = [];
            for (let i = 0; i < text.length; i++) {
                let c = text[i];
                if (c === '"') inQuotes = !inQuotes;
                else if (c === ',' && !inQuotes) { currentRow.push(curField.trim()); curField = ''; }
                else if ((c === '\n' || c === '\r') && !inQuotes) {
                    if (curField || currentRow.length > 0) {
                        currentRow.push(curField.trim());
                        rows.push(currentRow);
                        currentRow = []; curField = '';
                    }
                } else curField += c;
            }
            return rows;
        }

        function processData() {
            const fileInput = document.getElementById('csvFile');
            if (!fileInput.files[0]) return alert("Vui l√≤ng ch·ªçn file CSV!");

            const tier = document.getElementById('tierFilter').value;
            const hhMax = parseFloat(document.getElementById('hhLimit').value);
            const saleMin = parseInt(document.getElementById('minSales').value);
            const priceRange = priceTiers[tier];

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = parseCSV(e.target.result);
                let html = '', total = 0, hot = 0, high = 0, filtered = 0;

                data.forEach((cols, i) => {
                    if (i === 0 || cols.length < 8) return;

                    const name = cols[1] || "Kh√¥ng t√™n";
                    const priceRaw = cols[2] ? cols[2].replace(/[",.]/g, '') : "0";
                    const priceVal = parseInt(priceRaw);
                    const salesStr = cols[3].toLowerCase();
                    const hh = parseFloat(cols[5].replace('%', '').replace(',', '.'));
                    const link = cols[8];

                    // Chuy·ªÉn ƒë·ªïi "10k+" th√†nh s·ªë 10
                    let salesNum = salesStr.includes('k') ? parseFloat(salesStr.replace('k+', '')) : parseFloat(salesStr)/1000;

                    // Th·ªëng k√™ t·ªïng qu√°t
                    total++;
                    if (salesNum >= 100) hot++;
                    if (hh >= 15) high++;

                    // √Åp d·ª•ng b·ªô l·ªçc ƒëa t·∫ßng
                    if (priceVal >= priceRange[0] && priceVal <= priceRange[1] && 
                        hh <= hhMax && salesNum >= saleMin) {
                        filtered++;
                        html += `<tr>
                            <td>${name.substring(0, 50)}...</td>
                            <td class="price">${priceVal.toLocaleString()}ƒë</td>
                            <td><span class="sales-badge">${cols[3]}</span></td>
                            <td style="color:var(--shopee); font-weight:bold">${hh}%</td>
                            <td><a href="${link}" target="_blank" class="btn-link">L·∫§Y LINK</a></td>
                        </tr>`;
                    }
                });

                document.getElementById('totalItems').innerText = total;
                document.getElementById('hotItems').innerText = hot;
                document.getElementById('highComm').innerText = high;
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('resultBody').innerHTML = html || "<tr><td colspan='5' style='text-align:center'>Kh√¥ng t√¨m th·∫•y si√™u ph·∫©m n√†o kh·ªõp ƒëi·ªÅu ki·ªán.</td></tr>";
                document.getElementById('resultTable').style.display = 'table';
            };
            reader.readAsText(fileInput.files[0]);
        }

        function addCust() {
            customers++;
            localStorage.setItem('cust_count', customers);
            document.getElementById('custCount').innerText = customers;
            if(customers === 20) alert("üéØ Ch·∫°m m·ªëc 20 kh√°ch! H√£y d·ª´ng vi·ªác l·ªçc h√†ng v√† b·∫Øt ƒë·∫ßu g·ª≠i tin nh·∫Øn chƒÉm s√≥c.");
        }

        function updateSteps() {
            const h = new Date().getHours();
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            if(h >= 8 && h < 10) document.getElementById('step1').classList.add('active');
            else if(h >= 10 && h < 14) document.getElementById('step2').classList.add('active');
            else if(h >= 14 && h < 18) document.getElementById('step3').classList.add('active');
            else if(h >= 19 && h < 23) document.getElementById('step4').classList.add('active');
        }
        updateSteps();
        setInterval(updateSteps, 60000);
    </script>
</body>
</html>
