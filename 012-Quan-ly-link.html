<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Affiliate Dashboard â€“ Shopee</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff5722">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6fa;
  max-width:1100px;
  margin:auto;
  padding:15px;
}
h1{color:#ff5722}
.card{
  background:#fff;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,.1);
}
input,select,button{
  padding:8px;
  margin:5px 0;
  width:100%;
}
button{
  background:#ff5722;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
button:hover{opacity:.9}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border-bottom:1px solid #ddd;
  padding:8px;
  text-align:left;
}
small{color:#777}
</style>
</head>

<body>

<h1>ğŸ“Š Shopee Affiliate Dashboard</h1>

<div class="card">
<h3>â• ThÃªm link má»›i</h3>
<input id="title" placeholder="TÃªn bÃ i / sáº£n pháº©m">
<input id="platform" placeholder="Ná»n táº£ng (Facebook / Zaloâ€¦)">
<input id="link" placeholder="Link Shopee Affiliate">
<input id="click" type="number" placeholder="Sá»‘ click (xem trong Shopee)">
<input id="order" type="number" placeholder="Sá»‘ Ä‘Æ¡n">
<input id="money" type="number" placeholder="Hoa há»“ng (VNÄ)">
<button onclick="add()">LÆ°u link</button>
</div>

<div class="card">
<h3>ğŸ“… Lá»c dá»¯ liá»‡u</h3>
<select id="filter" onchange="render()">
<option value="all">Táº¥t cáº£</option>
<option value="week">7 ngÃ y gáº§n nháº¥t</option>
<option value="month">30 ngÃ y gáº§n nháº¥t</option>
</select>
<button onclick="exportCSV()">ğŸ“¤ Xuáº¥t Excel</button>
</div>

<div class="card">
<h3>ğŸ“‹ Danh sÃ¡ch link</h3>
<table>
<thead>
<tr>
<th>BÃ i</th>
<th>Ná»n táº£ng</th>
<th>Click</th>
<th>ÄÆ¡n</th>
<th>Hoa há»“ng</th>
<th>NgÃ y</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<div class="card">
<h3>ğŸ“ˆ Biá»ƒu Ä‘á»“ hoa há»“ng</h3>
<canvas id="chart"></canvas>
</div>

<script>
let data = JSON.parse(localStorage.getItem("aff")) || [];

function add(){
  data.push({
    title:title.value,
    platform:platform.value,
    link:link.value,
    click:+click.value||0,
    order:+order.value||0,
    money:+money.value||0,
    date:Date.now()
  });
  localStorage.setItem("aff",JSON.stringify(data));
  render();
}

function render(){
  let tbody="";
  let now=Date.now();
  let filter=document.getElementById("filter").value;
  let show=data.filter(i=>{
    let diff=(now-i.date)/86400000;
    if(diff>30) return false; // tá»± xÃ³a sau 30 ngÃ y
    if(filter==="week") return diff<=7;
    if(filter==="month") return diff<=30;
    return true;
  });

  show.forEach(i=>{
    tbody+=`
    <tr>
      <td>${i.title}</td>
      <td>${i.platform}</td>
      <td>${i.click}</td>
      <td>${i.order}</td>
      <td>${i.money.toLocaleString()}Ä‘</td>
      <td><small>${new Date(i.date).toLocaleDateString()}</small></td>
    </tr>`;
  });
  document.getElementById("list").innerHTML=tbody;
  draw(show);
}

function draw(show){
  let ctx=document.getElementById("chart");
  let labels=show.map(i=>i.title);
  let values=show.map(i=>i.money);
  if(window.c) window.c.destroy();
  window.c=new Chart(ctx,{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{
        label:"Hoa há»“ng (VNÄ)",
        data:values
      }]
    }
  });
}

function exportCSV(){
  let csv="TÃªn,Ná»n táº£ng,Click,ÄÆ¡n,Hoa há»“ng,NgÃ y\n";
  data.forEach(i=>{
    csv+=`${i.title},${i.platform},${i.click},${i.order},${i.money},${new Date(i.date).toLocaleDateString()}\n`;
  });
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="affiliate.csv";
  a.click();
}

render();
</script>

</body>
</html>
