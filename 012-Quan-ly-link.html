<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Ph√¢n T√≠ch & Shopee Affiliate Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --shopee-orange: #ff5722; --bg: #f4f6fa; --dark: #2c3e50; --success: #2ecc71; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: auto; padding: 15px; max-width: 1200px; }
        h1 { color: var(--shopee-orange); text-align: center; margin-bottom: 25px; }
        
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 850px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .card { background: #fff; padding: 20px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-top: 4px solid var(--shopee-orange); }
        .card h3 { margin-top: 0; color: var(--dark); display: flex; align-items: center; gap: 10px; font-size: 1.1rem; }
        
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--shopee-orange); color: #fff; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; margin-top: 10px;}
        button:hover { background: #e64a19; transform: translateY(-2px); }
        .btn-save { background: var(--success); }
        
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border-bottom: 1px solid #eee; padding: 12px 8px; text-align: left; font-size: 14px; }
        .highlight { background: #fff3cd; font-weight: bold; padding: 2px 5px; border-radius: 4px; }
        .result-box { background: #f8f9fa; border: 1px dashed #ccc; padding: 10px; font-size: 13px; margin-top: 10px; border-radius: 6px; white-space: pre-wrap; }
    </style>
</head>
<body>

<h1><i class="fas fa-rocket"></i> Shopee Affiliate Pro Hub</h1>

<div class="dashboard-grid">
    
    <div class="card">
        <h3><i class="fas fa-magic"></i> 1. G·∫Øn Link V√†o Truy·ªán & T·∫°o SubID</h3>
        <textarea id="inputText" rows="4" placeholder="D√°n n·ªôi dung truy·ªán/b√†i vi·∫øt..."></textarea>
        
        <div style="display:flex; gap:10px">
            <input id="shortLink" placeholder="D√°n Link R√∫t G·ªçn Shopee v√†o ƒë√¢y...">
            <button onclick="processEverything()" style="width:150px">X·ª¨ L√ù NGAY</button>
        </div>

        <div id="analysisResult" style="margin-top:10px; font-size: 12px;"></div>
        
        <p style="font-size: 12px; font-weight: bold; margin-bottom: 5px;">K·∫øt qu·∫£ b√†i ƒëƒÉng (M√°y ƒë√£ g·∫Øn link):</p>
        <div id="finalContent" class="result-box">Ch∆∞a c√≥ d·ªØ li·ªáu...</div>
        <button onclick="copyToClipboard('finalContent')" class="btn-save" style="padding:5px; font-size:11px;">Copy B√†i Vi·∫øt</button>
    </div>

    <div class="card">
        <h3><i class="fas fa-database"></i> 2. L∆∞u Kho & Google Sheet</h3>
        <input id="title" placeholder="T√™n s·∫£n ph·∫©m">
        <div style="display:flex; gap:10px">
            <input id="money" type="number" placeholder="Hoa h·ªìng d·ª± ki·∫øn">
            <input id="platform" placeholder="N·ªÅn t·∫£ng (Zalo/FB)">
        </div>
        
        <button onclick="saveToSystem()" class="btn-save"><i class="fas fa-save"></i> L∆ØU KHO & GHI ƒê·ªÄ GITHUB</button>

        <p style="font-size: 12px; font-weight: bold; margin-top: 15px; margin-bottom: 5px;">D√≤ng d·ªØ li·ªáu cho Google Sheet:</p>
        <div id="sheetRow" class="result-box">Ng√†y | T√™n | Link | HH</div>
        <button onclick="copyToClipboard('sheetRow')" style="background:#4285f4; padding:5px; font-size:11px;">Copy D√≤ng Sheet</button>
    </div>

</div>

<div class="card">
    <h3><i class="fas fa-history"></i> L·ªãch s·ª≠ l∆∞u kho (D√πng ƒë·ªÉ d√°n v√†o files.json tr√™n GitHub)</h3>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Link R√∫t G·ªçn</th>
                    <th>HH</th>
                    <th>Ng√†y</th>
                </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
    </div>
</div>

<script>
let affData = JSON.parse(localStorage.getItem("aff_pro")) || [];

// 1. M√ÅY L√ÄM: X·ª≠ l√Ω g·∫Øn link, SubID
function processEverything() {
    const text = document.getElementById('inputText').value;
    const link = document.getElementById('shortLink').value;
    
    if(!link) { alert("H√£y d√°n link r√∫t g·ªçn v√†o!"); return; }

    // G·∫Øn link v√†o cu·ªëi truy·ªán
    const completePost = text + "\n\nüëâ SƒÉn ngay t·∫°i ƒë√¢y: " + link;
    document.getElementById('finalContent').innerText = completePost;

    // Ph√¢n t√≠ch SubID g·ª£i √Ω
    const words = text.split(/\s+/).filter(w => w.length > 0);
    const counts = {};
    words.forEach(w => {
        let char = w.slice(-1).toUpperCase();
        if(/[A-Z]/.test(char)) counts[char] = (counts[char] || 0) + 1;
    });
    const topChar = Object.entries(counts).sort((a,b) => b[1] - a[1])[0];
    document.getElementById('analysisResult').innerHTML = `G·ª£i √Ω SubID: <span class="highlight">WEB_${new Date().getDate()}_${topChar ? topChar[0] : 'X'}</span>`;
}

// 2. M√ÅY L√ÄM: T·∫°o d√≤ng Google Sheet & L∆∞u LocalStorage
function saveToSystem() {
    const title = document.getElementById('title').value;
    const link = document.getElementById('shortLink').value;
    const money = document.getElementById('money').value;
    const date = new Date().toLocaleDateString();

    if(!title || !link) { alert("Thi·∫øu t√™n ho·∫∑c link!"); return; }

    // T·∫°o d√≤ng cho Google Sheet
    const row = `${date}\t${title}\t${link}\t${money}ƒë`;
    document.getElementById('sheetRow').innerText = row;

    // L∆∞u v√†o danh s√°ch h·ªá th·ªëng
    affData.push({
        title: title,
        link: link,
        money: parseInt(money) || 0,
        date: Date.now(),
        platform: document.getElementById('platform').value || 'Web'
    });

    localStorage.setItem("aff_pro", JSON.stringify(affData));
    render();
    alert("ƒê√£ l∆∞u kho th√†nh c√¥ng!");
}

function render() {
    let html = "";
    affData.sort((a,b) => b.date - a.date).slice(0, 10).forEach(i => {
        html += `<tr>
            <td>${i.title}</td>
            <td><small>${i.link}</small></td>
            <td>${i.money.toLocaleString()}ƒë</td>
            <td>${new Date(i.date).toLocaleDateString()}</td>
        </tr>`;
    });
    document.getElementById('list').innerHTML = html;
}

function copyToClipboard(id) {
    const text = document.getElementById(id).innerText;
    navigator.clipboard.writeText(text);
    alert("ƒê√£ copy!");
}

window.onload = render;
</script>
</body>
</html>
