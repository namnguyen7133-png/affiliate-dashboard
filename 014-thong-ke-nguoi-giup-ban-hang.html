<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Si√™u H·ªá Th·ªëng Affiliate - Kim T·ª© ƒê·ªì & CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --color-L: #dc3545; --color-T: #007bff; --color-C: #6f42c1; --color-D: #ffc107; 
            --shopee-orange: #ff5722; --bg: #f4f6f8; --success: #28a745;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 1200px; margin: auto; }
        
        /* Header & CRM Bar */
        .top-bar { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 20px; }
        @media (max-width: 768px) { .top-bar { grid-template-columns: 1fr; } }

        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); height: 100%; }
        
        /* CRM Style */
        .crm-box { text-align: center; border-left: 5px solid var(--success); }
        .crm-count { font-size: 32px; font-weight: bold; color: var(--success); margin: 5px 0; }
        .progress-container { background: #eee; border-radius: 10px; height: 10px; margin: 10px 0; overflow: hidden; }
        .progress-bar { background: var(--success); height: 100%; width: 0%; transition: 0.5s; }
        
        /* Kim T·ª© ƒê·ªì Tabs */
        .quadrant-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { 
            flex: 1; min-width: 100px; padding: 15px; border: none; border-radius: 12px; 
            color: white; font-weight: bold; cursor: pointer; opacity: 0.6; transition: 0.3s;
        }
        .tab-btn.active { opacity: 1; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        /* Main Workspace */
        .main-layout { display: grid; grid-template-columns: 1.2fr 2fr; gap: 20px; }
        @media (max-width: 900px) { .main-layout { grid-template-columns: 1fr; } }

        textarea { width: 100%; border: 1px solid #ddd; border-radius: 10px; padding: 10px; resize: vertical; }
        .btn-add { background: var(--shopee-orange); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }

        .alert-care { background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; border-left: 5px solid #ffc107; animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(5px); } 50% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-bar">
        <div class="card" style="background: linear-gradient(135deg, #2c3e50, #000); color: white;">
            <h2 style="margin:0">üíé Affiliate Strategy Hub</h2>
            <p id="q-desc" style="opacity:0.8; font-size:14px;">Ch·ªçn t·∫ßng ƒë·ªÉ b·∫Øt ƒë·∫ßu l·ªçc s·∫£n ph·∫©m...</p>
        </div>
        
        <div class="card crm-box">
            <div style="font-size: 12px; font-weight: bold; color: #666;">M·ª§C TI√äU CHƒÇM S√ìC KH√ÅCH</div>
            <div class="crm-count"><span id="custCount">0</span>/20</div>
            <div class="progress-container"><div class="progress-bar" id="pBar"></div></div>
            <div style="display: flex; gap: 5px;">
                <button onclick="addCust()" style="flex:2; background: var(--success); color: white; border: none; border-radius: 4px; padding: 5px; cursor: pointer;">+1 Kh√°ch</button>
                <button onclick="resetCust()" style="flex:1; background: #eee; border: none; border-radius: 4px; cursor: pointer;">Reset</button>
            </div>
        </div>
    </div>

    <div id="careAlert" class="alert-care">
        <strong>‚òï ƒê√£ ƒë·∫°t m·ªëc 20 kh√°ch h√†ng!</strong> D·ª´ng t√¨m kh√°ch m·ªõi, h√£y nh·∫Øn tin chƒÉm s√≥c ng∆∞·ªùi quen, g·ª≠i l·ªùi c·∫£m ∆°n ho·∫∑c t·∫∑ng m√£ gi·∫£m gi√° Shopee ƒë·ªÉ duy tr√¨ t·ª∑ l·ªá chuy·ªÉn ƒë·ªïi.
    </div>

    <div class="quadrant-tabs">
        <button class="tab-btn active" style="background:var(--color-L)" onclick="changeQ('L')">L (D∆∞·ªõi 200k)</button>
        <button class="tab-btn" style="background:var(--color-T)" onclick="changeQ('T')">T (200k-1tr)</button>
        <button class="tab-btn" style="background:var(--color-C)" onclick="changeQ('C')">C (1tr-5tr)</button>
        <button class="tab-btn" style="background:var(--color-D)" onclick="changeQ('D')">ƒê (Tr√™n 5tr)</button>
    </div>

    <div class="main-layout">
        <div class="card">
            <h3><i class="fas fa-search"></i> L·ªçc & T·∫°o SubID</h3>
            <textarea id="csvInput" rows="8" placeholder="D√°n d·ªØ li·ªáu Shopee v√†o ƒë√¢y..."></textarea>
            <div id="subIdResult" style="margin: 10px 0; font-family: monospace; font-weight: bold; color: var(--color-T);"></div>
            <button class="btn-add" onclick="processData()">PH√ÇN T√çCH CHI·∫æN D·ªäCH</button>
        </div>

        <div class="card">
            <h3><i class="fas fa-chart-line"></i> K·∫øt qu·∫£ ph√¢n t√≠ch</h3>
            <div id="resultArea">
                <p style="color:#999; text-align:center">Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã.</p>
            </div>
        </div>
    </div>
</div>



<script>
    let currentQ = 'L';
    let customers = parseInt(localStorage.getItem("cust_count")) || 0;

    const configs = {
        'L': { min: 0, max: 200000, desc: "L (L√†m thu√™): H√†ng gi√° r·∫ª, t·∫≠p trung s·ªë l∆∞·ª£ng ƒë∆°n l·ªõn (Mass Marketing)." },
        'T': { min: 200001, max: 1000000, desc: "T (T·ª± doanh): H√†ng trung c·∫•p, b·∫Øt ƒë·∫ßu c·∫ßn t∆∞ v·∫•n c√° nh√¢n." },
        'C': { min: 1000001, max: 5000000, desc: "C (Ch·ªß h·ªá th·ªëng): H√†ng gi√° tr·ªã cao, c·∫ßn x√¢y d·ª±ng c·ªông ƒë·ªìng." },
        'D': { min: 5000001, max: 99999999, desc: "ƒê (ƒê·∫ßu t∆∞): H√†ng xa x·ªâ, ch·ªâ c·∫ßn 1 ƒë∆°n c≈©ng ƒë·ªß m·ª•c ti√™u." }
    };

    function updateCRM() {
        document.getElementById("custCount").innerText = customers;
        let percent = Math.min((customers / 20) * 100, 100);
        document.getElementById("pBar").style.width = percent + "%";
        document.getElementById("careAlert").style.display = customers >= 20 ? "block" : "none";
        localStorage.setItem("cust_count", customers);
    }

    function addCust() { customers++; updateCRM(); }
    function resetCust() { if(confirm("X√≥a data kh√°ch?")) { customers = 0; updateCRM(); } }

    function changeQ(q) {
        currentQ = q;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('q-desc').innerText = configs[q].desc;
        processData();
    }

    function processData() {
        const raw = document.getElementById("csvInput").value;
        if(!raw) return;

        // Ph√¢n t√≠ch SubID g·ª£i √Ω (File 006)
        const subId = `${currentQ}_${new Date().getDate()}${new Date().getMonth()+1}_PRO`;
        document.getElementById("subIdResult").innerText = "G·ª£i √Ω SubID: " + subId;

        // L·ªçc d·ªØ li·ªáu (File 011)
        const lines = raw.split('\n');
        let html = `<table><tr><th>S·∫£n ph·∫©m</th><th>Gi√°</th><th>ƒê∆°n m·ª•c ti√™u</th></tr>`;
        let found = 0;

        lines.slice(1).forEach(line => {
            const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(cols.length < 5) return;
            
            const name = cols[1].replace(/"/g, '');
            const price = parseInt(cols[2].replace(/[",.]/g, '')) || 0;
            
            if(price >= configs[currentQ].min && price <= configs[currentQ].max) {
                const goal = Math.ceil(1000000 / (price * 0.05)); // Gi·∫£ ƒë·ªãnh hoa h·ªìng 5%
                html += `<tr><td>${name.substring(0,30)}...</td><td>${price.toLocaleString()}ƒë</td><td style="color:red; font-weight:bold">${goal} ƒë∆°n</td></tr>`;
                found++;
            }
        });

        html += `</table>`;
        document.getElementById("resultArea").innerHTML = found > 0 ? html : "Kh√¥ng t√¨m th·∫•y SP ph√π h·ª£p t·∫ßng n√†y.";
    }

    updateCRM();
    document.getElementById('q-desc').innerText = configs['L'].desc;
</script>
</body>
</html>
