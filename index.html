<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Affiliate Dashboard</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f6fa;
  max-width:1000px;
  margin:auto;
  padding:15px;
}
h1{text-align:center;color:#0b4f6c}
.card{
  background:#fff;
  padding:15px;
  border-radius:12px;
  margin:15px 0;
}
canvas{max-width:100%}
</style>
</head>

<body>

<h1>üìä AFFILIATE DASHBOARD</h1>

<div class="card">
  <h3>üí∞ Hoa h·ªìng theo ng√†y</h3>
  <canvas id="commissionDayChart" height="120"></canvas>
</div>

<div class="card">
  <h3>üìÜ Hoa h·ªìng theo tu·∫ßn</h3>
  <canvas id="commissionWeekChart" height="120"></canvas>
</div>

<div class="card">
  <h3>üóìÔ∏è Hoa h·ªìng theo th√°ng</h3>
  <canvas id="commissionMonthChart" height="120"></canvas>
</div>

<script>
fetch("data/hoa-hong.csv")
  .then(res => res.text())
  .then(text => {

    const rows = text.trim().split("\n").slice(1);

    const dayLabels = [];
    const dayValues = [];

    const weekMap = {};
    const monthMap = {};

    rows.forEach(row => {
      const [date, commission] = row.split(",");
      const value = Number(commission);

      /* NG√ÄY */
      dayLabels.push(date);
      dayValues.push(value);

      const d = new Date(date);
      const year = d.getFullYear();

      /* TU·∫¶N */
      const week = Math.ceil(
        ((d - new Date(year,0,1)) / 86400000 + new Date(year,0,1).getDay()+1) / 7
      );
      const weekKey = `${year}-W${week}`;
      weekMap[weekKey] = (weekMap[weekKey] || 0) + value;

      /* TH√ÅNG */
      const monthKey = `${year}-${String(d.getMonth()+1).padStart(2,"0")}`;
      monthMap[monthKey] = (monthMap[monthKey] || 0) + value;
    });

    const chartOption = {
      responsive: true,
      plugins:{
        tooltip:{
          callbacks:{
            label:c=>c.raw.toLocaleString("vi-VN")+" ‚Ç´"
          }
        }
      },
      scales:{
        y:{
          ticks:{
            callback:v=>v.toLocaleString("vi-VN")+" ‚Ç´"
          }
        }
      }
    };

    /* BI·ªÇU ƒê·ªí NG√ÄY */
    new Chart(document.getElementById("commissionDayChart"), {
      type: "line",
      data: {
        labels: dayLabels,
        datasets: [{
          label: "Hoa h·ªìng theo ng√†y",
          data: dayValues,
          borderWidth: 2,
          tension: 0.35
        }]
      },
      options: chartOption
    });

    /* BI·ªÇU ƒê·ªí TU·∫¶N */
    new Chart(document.getElementById("commissionWeekChart"), {
      type: "bar",
      data: {
        labels: Object.keys(weekMap),
        datasets: [{
          label: "Hoa h·ªìng theo tu·∫ßn",
          data: Object.values(weekMap)
        }]
      },
      options: chartOption
    });

    /* BI·ªÇU ƒê·ªí TH√ÅNG */
    new Chart(document.getElementById("commissionMonthChart"), {
      type: "bar",
      data: {
        labels: Object.keys(monthMap),
        datasets: [{
          label: "Hoa h·ªìng theo th√°ng",
          data: Object.values(monthMap)
        }]
      },
      options: chartOption
    });

  });
</script>

</body>
</html>
