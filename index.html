<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Affiliate Dashboard</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f6fa;
  max-width:1000px;
  margin:auto;
  padding:15px;
}
h1{text-align:center;color:#0b4f6c}
h3{margin-top:25px}
.menu a{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  margin:10px 0;
  font-size:16px;
  text-decoration:none;
  color:#fff;
  border-radius:10px;
}
.menu small{font-size:13px}
.done{opacity:.6;text-decoration:line-through}
.blue{background:#1565c0}
.green{background:#2e7d32}
.orange{background:#ef6c00}
.purple{background:#6a1b9a}
.progress{background:#ddd;border-radius:20px;overflow:hidden}
.bar{height:18px;background:#2e7d32;color:#fff;font-size:13px;text-align:center}
.card{
  background:#fff;
  padding:12px;
  border-radius:10px;
  margin:10px 0;
}
.highlight{
  background:#fff3cd;
  border-left:6px solid #ff9800;
}
button{cursor:pointer}
</style>
</head>

<body>

<h1>ğŸ“Œ AFFILIATE DASHBOARD</h1>

<h3>â­ Viá»‡c Æ°u tiÃªn hÃ´m nay</h3>
<div class="card highlight" id="priorityBox">Äang táº£iâ€¦</div>

<h3>ğŸ“‚ CÃ´ng viá»‡c</h3>

<!-- TAB -->
<div style="margin-bottom:10px">
  <button onclick="renderMenu('all')">ğŸ“‚ Táº¥t cáº£</button>
  <button onclick="renderMenu('shopee')">ğŸ›’ Shopee</button>
  <button onclick="renderMenu('tool')">ğŸ§° Tool</button>
</div>

<div class="menu" id="menu"></div>

<h3>ğŸ“Š Tiáº¿n Ä‘á»™</h3>
<div class="progress"><div class="bar" id="progressBar">0%</div></div>
<p>âœ… ÄÃ£ lÃ m: <b id="doneCount">0</b> | â³ CÃ²n: <b id="leftCount">0</b></p>

<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script>
let FILES = [];

const colors=["blue","green","orange","purple"];

const menu=document.getElementById("menu");
const doneCountEl=document.getElementById("doneCount");
const leftCountEl=document.getElementById("leftCount");
const progressBar=document.getElementById("progressBar");
const priorityBox=document.getElementById("priorityBox");

const doneMap=JSON.parse(localStorage.getItem("doneMap")||"{}");
const alarmMap=JSON.parse(localStorage.getItem("alarmMap")||"{}");

fetch("files.json")
  .then(r => r.json())
  .then(list => {
    FILES = list.filter(f => f.active);
    renderMenu("all");
    updateProgress();
    updatePriority();
  })
  .catch(()=>{
    priorityBox.innerText="âŒ KhÃ´ng Ä‘á»c Ä‘Æ°á»£c files.json";
  });

function renderMenu(type){
  menu.innerHTML="";
  const show = FILES.filter(f => type==="all" || f.platform===type);

  show.forEach((f,i)=>{
    const key=f.file;
    const a=document.createElement("a");
    a.href=f.file;
    a.className=colors[i%4]+(doneMap[key]?" done":"");
    a.innerHTML=`
      <span>
        ${f.name}
        <br><small>â° ${alarmMap[key]||"--:--"}</small>
      </span>
      <span>
        <input type="time" value="${alarmMap[key]||""}"
          onchange="setAlarm('${key}',this.value)">
        <button onclick="toggleDone(event,'${key}')">
          ${doneMap[key]?"â†©":"âœ”"}
        </button>
      </span>
    `;
    menu.appendChild(a);
  });
}

function toggleDone(e,key){
  e.preventDefault();
  doneMap[key]=!doneMap[key];
  localStorage.setItem("doneMap",JSON.stringify(doneMap));
  updateProgress();
  updatePriority();
  renderMenu("all");
}

function setAlarm(key,t){
  alarmMap[key]=t;
  localStorage.setItem("alarmMap",JSON.stringify(alarmMap));
}

function updateProgress(){
  const keys=FILES.map(f=>f.file);
  const done=keys.filter(k=>doneMap[k]).length;
  doneCountEl.innerText=done;
  leftCountEl.innerText=keys.length-done;
  const percent=keys.length?Math.round(done/keys.length*100):0;
  progressBar.style.width=percent+"%";
  progressBar.innerText=percent+"%";
}

function updatePriority(){
  let next=null;
  FILES.forEach(f=>{
    const k=f.file;
    if(!doneMap[k] && alarmMap[k]){
      if(!next || alarmMap[k]<alarmMap[next]) next=k;
    }
  });
  priorityBox.innerHTML = next
    ? `ğŸ”” <b>${next.replace(".html","")}</b><br>â° ${alarmMap[next]}`
    : "ğŸ‰ KhÃ´ng cÃ²n viá»‡c gáº¥p hÃ´m nay";
}
</script>

</body>
</html>
