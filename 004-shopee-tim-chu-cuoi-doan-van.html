<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Văn Bản Tiếng Việt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.5rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            resize: vertical;
            line-height: 1.5;
        }

        textarea:focus, input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        .btn-secondary {
            background-color: #2ecc71;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #27ae60;
            transform: scale(1.05);
        }

        .btn-warning {
            background-color: #e74c3c;
            color: white;
        }

        .btn-warning:hover {
            background-color: #c0392b;
            transform: scale(1.05);
        }

        .btn-info {
            background-color: #9b59b6;
            color: white;
        }

        .btn-info:hover {
            background-color: #8e44ad;
            transform: scale(1.05);
        }

        .result-box {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            line-height: 1.6;
        }

        .result-box ol, .result-box ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .result-box li {
            margin-bottom: 5px;
            padding-left: 5px;
        }

        .highlight {
            background-color: #fff3cd;
            color: #856404;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
        }

        /* Custom scrollbar */
        .result-box::-webkit-scrollbar {
            width: 8px;
        }

        .result-box::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .result-box::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 10px;
        }

        .result-box::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }

        .instructions {
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-language"></i> Phân Tích Văn Bản Tiếng Việt</h1>
            <p>Công cụ phân tích và xử lý văn bản tiếng Việt mạnh mẽ</p>
        </div>

        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng:</h3>
            <ul>
                <li><strong>Ô 1:</strong> Nhập văn bản cần phân tích</li>
                <li><strong>Ô 2:</strong> Nhập chữ cái cần tìm (có dấu)</li>
                <li><strong>Ô 3:</strong> Kết quả phân tích câu và cụm từ</li>
                <li><strong>Ô 4:</strong> Tìm chữ cái cuối từ và so sánh với ô 2</li>
                <li><strong>Ô 5:</strong> Chữ cái ở ô 2 sau khi chuyển thành không dấu</li>
                <li><strong>Ô 6:</strong> Hoán vị các chữ cái không dấu từ ô 5</li>
                <li><strong>Ô 7:</strong> Tìm chữ cái cuối từ và so sánh với ô 5</li>
            </ul>
        </div>

        <div class="main-grid">
            <!-- Ô 1: Nhập văn bản -->
            <div class="card">
                <h2><i class="fas fa-font"></i> Ô 1: Văn bản nhập vào</h2>
                <div class="input-group">
                    <label for="inputText">Nhập văn bản, chữ cái, ký tự:</label>
                    <textarea id="inputText" rows="6" placeholder="Nhập văn bản tiếng Việt của bạn ở đây...">Tiếng Việt, còn gọi là tiếng Việt Nam hay Việt ngữ, là ngôn ngữ của người Việt và là ngôn ngữ chính thức tại Việt Nam. Đây là tiếng mẹ đẻ của khoảng 85% dân cư Việt Nam, cùng với hơn 4 triệu Việt kiều.</textarea>
                </div>
                <div class="button-group">
                    <button class="btn-warning" onclick="clearInputText()">
                        <i class="fas fa-trash-alt"></i> Xóa văn bản
                    </button>
                </div>
            </div>

            <!-- Ô 2: Nhập chữ cái cần tìm -->
            <div class="card">
                <h2><i class="fas fa-search"></i> Ô 2: Chữ cái cần tìm</h2>
                <div class="input-group">
                    <label for="searchChars">Nhập chữ cái có dấu (tối đa 3 chữ):</label>
                    <input type="text" id="searchChars" placeholder="Ví dụ: A Ă Â" value="A Ă Â">
                </div>
                <div class="button-group">
                    <button class="btn-warning" onclick="clearSearchChars()">
                        <i class="fas fa-trash-alt"></i> Xóa chữ cái
                    </button>
                    <button class="btn-info" onclick="generatePermutations()">
                        <i class="fas fa-random"></i> Tạo hoán vị
                    </button>
                </div>
                <div class="result-box" id="permutationResult">
                    <!-- Kết quả hoán vị sẽ hiển thị ở đây -->
                </div>
            </div>

            <!-- Ô 3: Phân tích văn bản -->
            <div class="card">
                <h2><i class="fas fa-chart-pie"></i> Ô 3: Phân tích câu và cụm từ</h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="analyzeText()">
                        <i class="fas fa-chart-bar"></i> Phân tích văn bản
                    </button>
                </div>
                <div class="result-box" id="analysisResult">
                    <!-- Kết quả phân tích sẽ hiển thị ở đây -->
                </div>
            </div>

            <!-- Ô 4: Tìm chữ cái cuối từ -->
            <div class="card">
                <h2><i class="fas fa-text-width"></i> Ô 4: Tìm chữ cái cuối từ</h2>
                <div class="button-group">
                    <button class="btn-secondary" onclick="findLastLetters()">
                        <i class="fas fa-search"></i> Tìm chữ cuối từ
                    </button>
                </div>
                <div class="result-box" id="lastLettersResult">
                    <!-- Kết quả tìm chữ cái cuối từ sẽ hiển thị ở đây -->
                </div>
            </div>

            <!-- Ô 5: Chuyển chữ có dấu thành không dấu -->
            <div class="card">
                <h2><i class="fas fa-exchange-alt"></i> Ô 5: Chữ cái không dấu</h2>
                <div class="button-group">
                    <button class="btn-info" onclick="convertToNoAccent()">
                        <i class="fas fa-language"></i> Đổi thành không dấu
                    </button>
                </div>
                <div class="result-box" id="noAccentResult">
                    <!-- Kết quả chuyển đổi sẽ hiển thị ở đây -->
                </div>
            </div>

            <!-- Ô 6: Hoán vị chữ cái không dấu -->
            <div class="card">
                <h2><i class="fas fa-random"></i> Ô 6: Hoán vị chữ không dấu</h2>
                <div class="button-group">
                    <button class="btn-info" onclick="generateNoAccentPermutations()">
                        <i class="fas fa-random"></i> Tạo hoán vị
                    </button>
                </div>
                <div class="result-box" id="noAccentPermutationResult">
                    <!-- Kết quả hoán vị sẽ hiển thị ở đây -->
                </div>
            </div>

            <!-- Ô 7: Tìm chữ cái cuối từ với chữ không dấu -->
            <div class="card">
                <h2><i class="fas fa-text-width"></i> Ô 7: Tìm chữ cuối từ (không dấu)</h2>
                <div class="button-group">
                    <button class="btn-secondary" onclick="findLastLettersNoAccent()">
                        <i class="fas fa-search"></i> Tìm chữ cuối từ
                    </button>
                </div>
                <div class="result-box" id="lastLettersNoAccentResult">
                    <!-- Kết quả tìm chữ cái cuối từ với chữ không dấu sẽ hiển thị ở đây -->
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Ứng dụng Phân Tích Văn Bản Tiếng Việt &copy; 2023</p>
        </div>
    </div>

    <script>
        // Bảng chuyển đổi chữ có dấu sang không dấu
        const accentMap = {
            'A': 'A', 'Ă': 'A', 'Â': 'A', 'B': 'B', 'C': 'C', 'D': 'D', 'Đ': 'Đ', 'E': 'E', 'Ê': 'E',
            'G': 'G', 'H': 'H', 'I': 'I', 'K': 'K', 'L': 'L', 'M': 'M', 'N': 'N', 'O': 'O', 'Ô': 'O',
            'Ơ': 'O', 'P': 'P', 'Q': 'Q', 'R': 'R', 'S': 'S', 'T': 'T', 'U': 'U', 'Ư': 'U', 'V': 'V',
            'X': 'X', 'Y': 'Y', 'À': 'A', 'Á': 'A', 'Ả': 'A', 'Ã': 'A', 'Ạ': 'A', 'Ằ': 'A', 'Ắ': 'A',
            'Ẳ': 'A', 'Ẵ': 'A', 'Ặ': 'A', 'Ầ': 'A', 'Ấ': 'A', 'Ẩ': 'A', 'Ẫ': 'A', 'Ậ': 'A', 'È': 'E',
            'É': 'E', 'Ẻ': 'E', 'Ẽ': 'E', 'Ẹ': 'E', 'Ề': 'E', 'Ế': 'E', 'Ể': 'E', 'Ễ': 'E', 'Ệ': 'E',
            'Ì': 'I', 'Í': 'I', 'Ỉ': 'I', 'Ĩ': 'I', 'Ị': 'I', 'Ò': 'O', 'Ó': 'O', 'Ỏ': 'O', 'Õ': 'O',
            'Ọ': 'O', 'Ồ': 'O', 'Ố': 'O', 'Ổ': 'O', 'Ỗ': 'O', 'Ộ': 'O', 'Ờ': 'O', 'Ớ': 'O', 'Ở': 'O',
            'Ỡ': 'O', 'Ợ': 'O', 'Ù': 'U', 'Ú': 'U', 'Ủ': 'U', 'Ũ': 'U', 'Ụ': 'U', 'Ừ': 'U', 'Ứ': 'U',
            'Ử': 'U', 'Ữ': 'U', 'Ự': 'U', 'Ỳ': 'Y', 'Ý': 'Y', 'Ỷ': 'Y', 'Ỹ': 'Y', 'Ỵ': 'Y',
            'a': 'a', 'ă': 'a', 'â': 'a', 'b': 'b', 'c': 'c', 'd': 'd', 'đ': 'đ', 'e': 'e', 'ê': 'e',
            'g': 'g', 'h': 'h', 'i': 'i', 'k': 'k', 'l': 'l', 'm': 'm', 'n': 'n', 'o': 'o', 'ô': 'o',
            'ơ': 'o', 'p': 'p', 'q': 'q', 'r': 'r', 's': 's', 't': 't', 'u': 'u', 'ư': 'u', 'v': 'v',
            'x': 'x', 'y': 'y', 'à': 'a', 'á': 'a', 'ả': 'a', 'ã': 'a', 'ạ': 'a', 'ằ': 'a', 'ắ': 'a',
            'ẳ': 'a', 'ẵ': 'a', 'ặ': 'a', 'ầ': 'a', 'ấ': 'a', 'ẩ': 'a', 'ẫ': 'a', 'ậ': 'a', 'è': 'e',
            'é': 'e', 'ẻ': 'e', 'ẽ': 'e', 'ẹ': 'e', 'ề': 'e', 'ế': 'e', 'ể': 'e', 'ễ': 'e', 'ệ': 'e',
            'ì': 'i', 'í': 'i', 'ỉ': 'i', 'ĩ': 'i', 'ị': 'i', 'ò': 'o', 'ó': 'o', 'ỏ': 'o', 'õ': 'o',
            'ọ': 'o', 'ồ': 'o', 'ố': 'o', 'ổ': 'o', 'ỗ': 'o', 'ộ': 'o', 'ờ': 'o', 'ớ': 'o', 'ở': 'o',
            'ỡ': 'o', 'ợ': 'o', 'ù': 'u', 'ú': 'u', 'ủ': 'u', 'ũ': 'u', 'ụ': 'u', 'ừ': 'u', 'ứ': 'u',
            'ử': 'u', 'ữ': 'u', 'ự': 'u', 'ỳ': 'y', 'ý': 'y', 'ỷ': 'y', 'ỹ': 'y', 'ỵ': 'y'
        };

        // Hàm xóa văn bản ở ô 1
        function clearInputText() {
            document.getElementById('inputText').value = '';
            showNotification('Đã xóa văn bản ở ô 1');
        }

        // Hàm xóa chữ cái ở ô 2
        function clearSearchChars() {
            document.getElementById('searchChars').value = '';
            document.getElementById('permutationResult').innerHTML = '';
            showNotification('Đã xóa chữ cái ở ô 2');
        }

        // Hàm tạo hoán vị cho ô 2
        function generatePermutations() {
            const input = document.getElementById('searchChars').value.trim();
            if (!input) {
                showNotification('Vui lòng nhập chữ cái ở ô 2');
                return;
            }

            const chars = input.split(' ').filter(c => c.trim() !== '');
            const maxChars = Math.min(chars.length, 3);
            const selectedChars = chars.slice(0, maxChars);
            
            if (selectedChars.length === 0) {
                showNotification('Không có chữ cái hợp lệ để tạo hoán vị');
                return;
            }

            const permutations = getPermutations(selectedChars);
            let resultHTML = `<p><strong>Hoán vị của "${selectedChars.join(' ')}":</strong></p><ol>`;
            
            permutations.forEach(perm => {
                resultHTML += `<li>${perm.join(' ')}</li>`;
            });
            
            resultHTML += `</ol><p>Tổng cộng: ${permutations.length} hoán vị</p>`;
            document.getElementById('permutationResult').innerHTML = resultHTML;
            
            showNotification(`Đã tạo ${permutations.length} hoán vị`);
        }

        // Hàm tạo tất cả hoán vị của một mảng
        function getPermutations(arr) {
            const result = [];
            
            function permute(current, remaining) {
                if (remaining.length === 0) {
                    result.push([...current]);
                    return;
                }
                
                for (let i = 0; i < remaining.length; i++) {
                    current.push(remaining[i]);
                    const newRemaining = [...remaining.slice(0, i), ...remaining.slice(i + 1)];
                    permute(current, newRemaining);
                    current.pop();
                }
            }
            
            permute([], arr);
            return result;
        }

        // Hàm phân tích văn bản (ô 3)
        function analyzeText() {
            const text = document.getElementById('inputText').value.trim();
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 1');
                return;
            }

            // Tách văn bản thành các câu dựa trên dấu câu
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '<ol>';
            let counter = 1;
            
            sentences.forEach(sentence => {
                const trimmedSentence = sentence.trim();
                // Kiểm tra nếu câu dài hơn 10 từ hoặc 30 ký tự
                const wordCount = trimmedSentence.split(/\s+/).length;
                const charCount = trimmedSentence.length;
                
                if (wordCount > 10 || charCount > 30) {
                    resultHTML += `<li><strong>Câu ${counter}:</strong> ${trimmedSentence} <br><span class="highlight">(${wordCount} từ, ${charCount} ký tự)</span></li>`;
                    counter++;
                }
            });
            
            if (counter === 1) {
                resultHTML += '<li>Không có câu nào đủ điều kiện (lớn hơn 10 từ hoặc 30 ký tự)</li>';
            }
            
            resultHTML += '</ol>';
            document.getElementById('analysisResult').innerHTML = resultHTML;
            
            showNotification(`Đã phân tích ${counter-1} câu`);
        }

        // Hàm tìm chữ cái cuối mỗi từ (ô 4)
        function findLastLetters() {
            const text = document.getElementById('inputText').value.trim();
            const searchChars = document.getElementById('searchChars').value.trim().split(' ').filter(c => c.trim() !== '');
            
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 1');
                return;
            }
            
            if (searchChars.length === 0) {
                showNotification('Vui lòng nhập chữ cái cần tìm ở ô 2');
                return;
            }
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '';
            let totalMatches = 0;
            
            sentences.forEach((sentence, idx) => {
                const trimmedSentence = sentence.trim();
                const words = trimmedSentence.split(/\s+/).filter(w => w.length > 0);
                const lastLetters = words.map(word => {
                    // Lấy chữ cái cuối cùng, giữ nguyên dấu
                    return word.charAt(word.length - 1);
                });
                
                // Đếm số lần xuất hiện của các chữ cái cần tìm
                const matchCount = lastLetters.filter(letter => 
                    searchChars.some(searchChar => searchChar === letter)
                ).length;
                
                if (matchCount >= 3) {
                    totalMatches++;
                    let highlightedSentence = trimmedSentence;
                    
                    // Tô màu các chữ cái trùng khớp
                    searchChars.forEach(char => {
                        const regex = new RegExp(`(${char})(?![^<]*>)`, 'gi');
                        highlightedSentence = highlightedSentence.replace(regex, '<span class="highlight">$1</span>');
                    });
                    
                    resultHTML += `<p><strong>Dòng ${idx+1}:</strong> ${highlightedSentence}</p>`;
                    resultHTML += `<p><em>Chữ cái cuối mỗi từ:</em> ${lastLetters.join(', ')}</p>`;
                    resultHTML += `<p><span class="highlight">Tìm thấy ${matchCount} chữ cái trùng với "${searchChars.join(', ')}"</span></p><hr>`;
                }
            });
            
            if (totalMatches === 0) {
                resultHTML = '<p>Không tìm thấy dòng nào có ít nhất 3 chữ cái cuối từ trùng với chữ cái tìm kiếm.</p>';
            } else {
                resultHTML = `<p><strong>Tìm thấy ${totalMatches} dòng có ít nhất 3 chữ cái cuối từ trùng khớp:</strong></p>` + resultHTML;
            }
            
            document.getElementById('lastLettersResult').innerHTML = resultHTML;
            showNotification(`Đã tìm thấy ${totalMatches} dòng phù hợp`);
        }

        // Hàm chuyển chữ có dấu thành không dấu (ô 5)
        function convertToNoAccent() {
            const searchChars = document.getElementById('searchChars').value.trim();
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái ở ô 2');
                return;
            }
            
            let result = '';
            for (let char of searchChars) {
                result += accentMap[char] || char;
            }
            
            document.getElementById('noAccentResult').innerHTML = `
                <p><strong>Chữ cái gốc:</strong> ${searchChars}</p>
                <p><strong>Chữ cái không dấu:</strong> ${result}</p>
                <p><strong>Chi tiết chuyển đổi:</strong></p>
                <ul>
                    ${Array.from(searchChars).map(char => 
                        `<li>${char} → ${accentMap[char] || char}</li>`
                    ).join('')}
                </ul>
            `;
            
            showNotification('Đã chuyển đổi chữ có dấu thành không dấu');
        }

        // Hàm tạo hoán vị cho chữ không dấu (ô 6)
        function generateNoAccentPermutations() {
            const searchChars = document.getElementById('searchChars').value.trim();
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái ở ô 2');
                return;
            }
            
            // Chuyển đổi sang không dấu
            let noAccentChars = '';
            for (let char of searchChars) {
                noAccentChars += accentMap[char] || char;
            }
            
            const chars = noAccentChars.split(' ').filter(c => c.trim() !== '');
            const maxChars = Math.min(chars.length, 3);
            const selectedChars = chars.slice(0, maxChars);
            
            if (selectedChars.length === 0) {
                showNotification('Không có chữ cái hợp lệ để tạo hoán vị');
                return;
            }

            const permutations = getPermutations(selectedChars);
            let resultHTML = `<p><strong>Hoán vị của "${selectedChars.join(' ')}" (không dấu):</strong></p><ol>`;
            
            permutations.forEach(perm => {
                resultHTML += `<li>${perm.join(' ')}</li>`;
            });
            
            resultHTML += `</ol><p>Tổng cộng: ${permutations.length} hoán vị</p>`;
            document.getElementById('noAccentPermutationResult').innerHTML = resultHTML;
            
            showNotification(`Đã tạo ${permutations.length} hoán vị không dấu`);
        }

        // Hàm tìm chữ cái cuối mỗi từ với chữ không dấu (ô 7)
        function findLastLettersNoAccent() {
            const text = document.getElementById('inputText').value.trim();
            const searchChars = document.getElementById('searchChars').value.trim();
            
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 1');
                return;
            }
            
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái cần tìm ở ô 2');
                return;
            }
            
            // Chuyển đổi chữ tìm kiếm sang không dấu
            let noAccentSearchChars = '';
            for (let char of searchChars) {
                noAccentSearchChars += accentMap[char] || char;
            }
            
            const searchCharsArray = noAccentSearchChars.split(' ').filter(c => c.trim() !== '');
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '';
            let totalMatches = 0;
            
            sentences.forEach((sentence, idx) => {
                const trimmedSentence = sentence.trim();
                const words = trimmedSentence.split(/\s+/).filter(w => w.length > 0);
                const lastLetters = words.map(word => {
                    // Lấy chữ cái cuối cùng và chuyển sang không dấu
                    const lastChar = word.charAt(word.length - 1);
                    return accentMap[lastChar] || lastChar;
                });
                
                // Đếm số lần xuất hiện của các chữ cái cần tìm (không dấu)
                const matchCount = lastLetters.filter(letter => 
                    searchCharsArray.some(searchChar => searchChar === letter)
                ).length;
                
                if (matchCount >= 3) {
                    totalMatches++;
                    let highlightedSentence = trimmedSentence;
                    
                    // Tô màu các từ có chữ cái cuối trùng khớp (sau khi chuyển sang không dấu)
                    words.forEach(word => {
                        const lastChar = word.charAt(word.length - 1);
                        const lastCharNoAccent = accentMap[lastChar] || lastChar;
                        
                        if (searchCharsArray.includes(lastCharNoAccent)) {
                            const regex = new RegExp(`\\b${word}\\b`, 'g');
                            highlightedSentence = highlightedSentence.replace(regex, `<span class="highlight">${word}</span>`);
                        }
                    });
                    
                    resultHTML += `<p><strong>Dòng ${idx+1}:</strong> ${highlightedSentence}</p>`;
                    resultHTML += `<p><em>Chữ cái cuối mỗi từ (không dấu):</em> ${lastLetters.join(', ')}</p>`;
                    resultHTML += `<p><span class="highlight">Tìm thấy ${matchCount} chữ cái trùng với "${searchCharsArray.join(', ')}" (không dấu)</span></p><hr>`;
                }
            });
            
            if (totalMatches === 0) {
                resultHTML = '<p>Không tìm thấy dòng nào có ít nhất 3 chữ cái cuối từ trùng với chữ cái tìm kiếm (không dấu).</p>';
            } else {
                resultHTML = `<p><strong>Tìm thấy ${totalMatches} dòng có ít nhất 3 chữ cái cuối từ trùng khớp (không dấu):</strong></p>` + resultHTML;
            }
            
            document.getElementById('lastLettersNoAccentResult').innerHTML = resultHTML;
            showNotification(`Đã tìm thấy ${totalMatches} dòng phù hợp (không dấu)`);
        }

        // Hàm hiển thị thông báo
        function showNotification(message) {
            // Tạo thông báo tạm thời
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #2ecc71;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                transition: opacity 0.3s;
                opacity: 0;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Hiệu ứng xuất hiện
            setTimeout(() => notification.style.opacity = '1', 10);
            
            // Tự động biến mất sau 3 giây
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Khởi tạo các chức năng khi trang được tải
        window.onload = function() {
            // Tạo hoán vị ban đầu cho ô 2
            generatePermutations();
            
            // Phân tích văn bản ban đầu
            analyzeText();
            
            // Chuyển đổi sang không dấu ban đầu
            convertToNoAccent();
            
            // Tạo hoán vị không dấu ban đầu
            generateNoAccentPermutations();
            
            showNotification('Ứng dụng đã sẵn sàng! Vui lòng nhập văn bản để phân tích.');
        };
    </script>
</body>
</html>
