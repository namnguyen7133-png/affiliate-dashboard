<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Affiliate Kim T·ª© ƒê·ªì Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --color-L: #dc3545; --color-T: #007bff; --color-C: #6f42c1; --color-D: #ffc107; 
            --shopee-orange: #ff5722; --bg: #f0f2f5;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: auto; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #2c3e50, #000); color: white; padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }

        /* Quadrant Menu */
        .quadrant-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .q-btn { 
            padding: 20px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; 
            transition: 0.4s; text-align: center; position: relative; overflow: hidden;
        }
        .q-btn span { font-size: 24px; display: block; }
        .q-btn small { font-weight: normal; opacity: 0.8; }
        .q-btn.active { transform: scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .q-btn.active::after { content: 'üéØ'; position: absolute; top: 5px; right: 10px; }
        
        .btn-L { background: var(--color-L); } .btn-T { background: var(--color-T); }
        .btn-C { background: var(--color-C); } .btn-D { background: var(--color-D); color: #000; }

        /* Main Workspace */
        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        @media (max-width: 1000px) { .main-grid { grid-template-columns: 1fr; } }

        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }

        /* Inputs */
        textarea, input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-action { background: var(--shopee-orange); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }

        /* Result Area */
        #resultGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .product-card { border: 1px solid #eee; border-radius: 10px; padding: 15px; position: relative; border-top: 5px solid #ccc; transition: 0.3s; }
        .product-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .price { color: #ee4d2d; font-size: 18px; font-weight: bold; }
        .target-badge { background: #fff3cd; padding: 5px; border-radius: 5px; font-size: 12px; margin: 10px 0; display: block; }

        /* Th·ªëng k√™ */
        .stats-panel { display: flex; justify-content: space-around; background: #fff; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        .stat-item b { font-size: 20px; color: var(--shopee-orange); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-gem"></i> KIM T·ª® ƒê·ªí AFFILIATE PRO</h1>
        <p id="target-desc">L (Ng√†y): T·∫≠p trung s·ªë l∆∞·ª£ng ƒë∆°n c·ª±c l·ªõn ƒë·ªÉ t√≠ch ti·ªÉu th√†nh ƒë·∫°i.</p>
    </div>

    <div class="quadrant-menu">
        <div class="q-btn btn-L active" onclick="setQuadrant('L')"><span>L</span><small>D∆∞·ªõi 200k</small></div>
        <div class="q-btn btn-T" onclick="setQuadrant('T')"><span>T</span><small>200k - 1tr</small></div>
        <div class="q-btn btn-C" onclick="setQuadrant('C')"><span>C</span><small>1tr - 5tr</small></div>
        <div class="q-btn btn-D" onclick="setQuadrant('D')"><span>ƒê</span><small>Tr√™n 5tr</small></div>
    </div>

    <div class="main-grid">
        <div class="left-col">
            <div class="card">
                <h3><i class="fas fa-file-import"></i> Nh·∫≠p d·ªØ li·ªáu Shopee</h3>
                <textarea id="csvData" rows="6" placeholder="D√°n d·ªØ li·ªáu CSV t·ª´ Shopee ho·∫∑c n·ªôi dung qu·∫£ng b√°..."></textarea>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="targetMoney" placeholder="M·ª•c ti√™u thu nh·∫≠p (VNƒê)">
                    <button class="btn-action" onclick="executeAnalysis()" style="width: auto; flex-grow: 1;">CH·∫†Y PH√ÇN T√çCH</button>
                </div>
            </div>

            <div class="card" id="subIdHint">
                <h3><i class="fas fa-fingerprint"></i> G·ª£i √Ω SubID t·ªëi ∆∞u</h3>
                <div id="subIdContent">H√£y nh·∫≠p vƒÉn b·∫£n ƒë·ªÉ ph√¢n t√≠ch SubID...</div>
            </div>
        </div>

        <div class="right-col">
            <div class="stats-panel">
                <div class="stat-item">M·ª•c ti√™u<br><b id="statTarget">0ƒë</b></div>
                <div class="stat-item">S·∫£n ph·∫©m l·ªçc<br><b id="statCount">0</b></div>
                <div class="stat-item">ƒê∆°n c·∫ßn thi·∫øt<br><b id="statUnits">0</b></div>
            </div>

            <div id="resultGrid">
                </div>
        </div>
    </div>
</div>

<script>
    let currentQ = 'L';
    const configs = {
        'L': { minP: 0, maxP: 200000, money: 100000, desc: "L (Ng√†y): H√†ng d∆∞·ªõi 200k. D·ªÖ ch·ªët ƒë∆°n, t·∫≠p trung ph·ªß r·ªông." },
        'T': { minP: 200001, maxP: 1000000, money: 1000000, desc: "T (Tu·∫ßn): H√†ng 200k - 1tr. Thu nh·∫≠p kh√°, c·∫ßn t∆∞ v·∫•n nh·∫π." },
        'C': { minP: 1000001, maxP: 5000000, money: 5000000, desc: "C (Th√°ng): H√†ng 1tr - 5tr. X√¢y d·ª±ng th∆∞∆°ng hi·ªáu chuy√™n gia." },
        'D': { minP: 5000001, maxP: 999999999, money: 20000000, desc: "ƒê (NƒÉm): H√†ng tr√™n 5tr. SƒÉn 'c√° voi', hoa h·ªìng kh·ªßng." }
    };

    function setQuadrant(q) {
        currentQ = q;
        document.querySelectorAll('.q-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('.btn-' + q).classList.add('active');
        document.getElementById('targetMoney').value = configs[q].money;
        document.getElementById('target-desc').innerText = configs[q].desc;
        executeAnalysis();
    }

    function executeAnalysis() {
        const raw = document.getElementById('csvData').value.trim();
        const targetM = parseFloat(document.getElementById('targetMoney').value) || 0;
        const grid = document.getElementById('resultGrid');
        grid.innerHTML = '';

        // Ph√¢n t√≠ch SubID (K·∫ø th·ª´a t·ª´ 006)
        if(raw.length > 10) {
            const lastChars = raw.split(/\s+/).map(w => w.slice(-1).toUpperCase()).filter(c => /[A-Z]/.test(c));
            const freq = {}; lastChars.forEach(c => freq[c] = (freq[c] || 0) + 1);
            const top = Object.entries(freq).sort((a,b) => b[1]-a[1]).slice(0,3);
            document.getElementById('subIdContent').innerHTML = `G·ª£i √Ω SubID: <b>${currentQ}_${new Date().getDate()}_${top.map(x=>x[0]).join('')}</b>`;
        }

        // Logic l·ªçc CSV v√† t√≠nh to√°n (K·∫ø th·ª´a t·ª´ 011)
        const lines = raw.split('\n');
        let count = 0; let totalUnits = 0;

        lines.forEach(line => {
            const m = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if (!m || m.length < 6) return;

            const name = m[1].replace(/"/g, '');
            const price = parseFloat(m[2].replace(/[",.]/g, '')) || 0;
            const rate = parseFloat(m[5].replace(/[",%]/g, '')) || 0;

            if (price >= configs[currentQ].minP && price <= configs[currentQ].maxP) {
                const comm = (price * rate) / 100;
                const units = Math.ceil(targetM / comm);
                totalUnits += units;
                count++;

                const pCard = document.createElement('div');
                pCard.className = 'product-card';
                pCard.style.borderTopColor = getComputedStyle(document.documentElement).getPropertyValue('--color-'+currentQ);
                pCard.innerHTML = `
                    <div style="font-size:12px; font-weight:bold; height:32px; overflow:hidden;">${name}</div>
                    <div class="price">${price.toLocaleString()}ƒë</div>
                    <span class="target-badge">C·∫ßn b√°n: <b>${units} ƒë∆°n</b> ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u</span>
                    <button class="btn-action" style="padding:5px; font-size:11px;">L·∫§Y LINK</button>
                `;
                grid.appendChild(pCard);
            }
        });

        document.getElementById('statTarget').innerText = targetM.toLocaleString() + 'ƒë';
        document.getElementById('statCount').innerText = count;
        document.getElementById('statUnits').innerText = totalUnits;
    }

    window.onload = () => { document.getElementById('targetMoney').value = 100000; };
</script>
</body>
</html>
