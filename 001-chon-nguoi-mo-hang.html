<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Analytics Tool - Công cụ phân tích thông minh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --light-blue: #e7f1ff;
            --light-purple: #f3e8ff;
            --light-pink: #ffe8f0;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .header::after {
            content: "";
            position: absolute;
            bottom: -30%;
            left: -10%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Section Styling */
        .section {
            background: var(--light-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .section:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--secondary-color);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            background: var(--accent-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 22px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 1rem;
        }
        
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: white;
        }
        
        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .form-group input[readonly] {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            cursor: not-allowed;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #6c757d, #495057);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(to right, #20c997, #0ca678);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(32, 201, 151, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(to right, #ff9e00, #ff6d00);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(255, 157, 0, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
        }
        
        .btn-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(155, 89, 182, 0.3);
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }
        
        /* Result Boxes */
        .result-box {
            background: white;
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .result-box h3 {
            color: var(--secondary-color);
            margin-bottom: 12px;
            font-size: 1.3rem;
        }
        
        .result-box p {
            margin-bottom: 10px;
        }
        
        .highlight {
            background: linear-gradient(120deg, rgba(67, 97, 238, 0.1) 0%, rgba(114, 9, 183, 0.1) 100%);
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 700;
            color: var(--secondary-color);
            border-left: 3px solid var(--accent-color);
        }
        
        /* Alert Boxes */
        .alert {
            padding: 18px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        
        .alert-info {
            background: linear-gradient(to right, var(--light-blue), #dbeafe);
            border-color: var(--primary-color);
            color: var(--secondary-color);
        }
        
        .alert-warning {
            background: linear-gradient(to right, #fff3cd, #ffeaa7);
            border-color: #ffc107;
            color: #856404;
        }
        
        .alert-success {
            background: linear-gradient(to right, #d4edda, #c3e6cb);
            border-color: #28a745;
            color: #155724;
        }
        
        .alert-purple {
            background: linear-gradient(to right, var(--light-purple), #e9d5ff);
            border-color: var(--accent-color);
            color: var(--secondary-color);
        }
        
        .alert-pink {
            background: linear-gradient(to right, var(--light-pink), #ffd6e8);
            border-color: var(--warning-color);
            color: #8a0a3a;
        }
        
        /* Person Info */
        .person-info {
            background: linear-gradient(to right, #e7f1ff, #dbeafe);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .person-info h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .person-info p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Analysis Results */
        .analysis-results {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e5eb;
        }
        
        .result-item {
            padding: 15px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        
        .result-item:last-child {
            margin-bottom: 0;
        }
        
        .result-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .matched-text {
            background: linear-gradient(120deg, #ffec99 0%, #ffd43b 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            color: #856404;
        }
        
        /* Footer */
        .footer {
            background: linear-gradient(to right, var(--dark-color), #343a40);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-box {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e1e5eb;
        }
        
        .stat-box h4 {
            color: var(--secondary-color);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .stat-box .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
                gap: 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .btn {
                width: 100%;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--secondary-color), var(--accent-color));
        }
        
        /* Text Analysis Specific Styles */
        .text-analysis-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e1e5eb;
        }
        
        .text-analysis-card h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            font-size: 1.3rem;
        }
        
        .text-analysis-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            line-height: 1.6;
        }
        
        .text-analysis-result ol, .text-analysis-result ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .text-analysis-result li {
            margin-bottom: 5px;
            padding-left: 5px;
        }
        
        .text-highlight {
            background-color: #fff3cd;
            color: #856404;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        /* Tabs for Text Analysis */
        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .tab-btn:hover:not(.active) {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Instructions */
        .instructions {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
        }
        
        .instructions h4 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Smart Analytics Tool</h1>
            <p>Công cụ phân tích thông minh - Tự động hóa hoàn toàn quy trình phân tích</p>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Section 1: Basic Information -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-user-circle"></i> THÔNG TIN CƠ BẢN</h2>
                    
                    <div class="form-group">
                        <label for="currentDate"><i class="far fa-calendar-alt"></i> 1. Ngày hiện tại</label>
                        <input type="date" id="currentDate" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="personList"><i class="fas fa-list-ul"></i> 2. Danh sách người</label>
                        <select id="personList">
                            <option value="">-- Chọn một người --</option>
                        </select>
                    </div>
                    
                    <div class="alert alert-info">
                        <strong><i class="fas fa-info-circle"></i> Hướng dẫn:</strong> Chọn ngày hiện tại, chọn người từ danh sách, sau đó nhấn nút "Tự động phân tích".
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-success" id="btnAutoAnalyze">
                            <i class="fas fa-robot"></i> Tự động phân tích (Tất cả bước)
                        </button>
                        <button class="btn btn-secondary" id="btnReset">
                            <i class="fas fa-redo"></i> Đặt lại
                        </button>
                    </div>
                </div>
                
                <!-- Section 2: Step 1 Calculation -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-calculator"></i> BƯỚC 1: TÍNH TOÁN CHỈ SỐ</h2>
                    
                    <div class="form-group">
                        <label>3. Kết quả bước 1</label>
                        <div class="result-box" id="step1Result">
                            <h3><i class="fas fa-chart-bar"></i> Kết quả tính toán</h3>
                            <p>Kết quả sẽ hiển thị ở đây sau khi thực hiện bước 1</p>
                        </div>
                    </div>
                    
                    <div id="foundPersonInfo"></div>
                </div>
                
                <!-- Section 3: Steps 2 & 3 -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-shopping-cart"></i> BƯỚC 2 & 3: PHÂN TÍCH NHU CẦU</h2>
                    
                    <div class="form-group">
                        <label for="personName"><i class="fas fa-user"></i> Tên người đã chọn</label>
                        <input type="text" id="personName" placeholder="Tên sẽ tự động điền..." readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="birthDate"><i class="fas fa-birthday-cake"></i> Ngày sinh</label>
                        <input type="date" id="birthDate" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="age"><i class="fas fa-user-clock"></i> 4. Tuổi (Bước 2)</label>
                        <input type="text" id="age" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="shoppingNeeds"><i class="fas fa-tags"></i> 5. Nhu cầu mua hàng (Bước 3)</label>
                        <input type="text" id="shoppingNeeds" readonly>
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="right-column">
                <!-- Section 4: Name Analysis -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-font"></i> BƯỚC 4: PHÂN TÍCH TÊN</h2>
                    
                    <div class="form-group">
                        <label for="lastLetters"><i class="fas fa-text-height"></i> 6. Các chữ cái cuối trong tên</label>
                        <input type="text" id="lastLetters" placeholder="Các chữ cuối sẽ xuất hiện ở đây..." readonly>
                        <small style="color: var(--gray-color); margin-top: 5px; display: block;">
                            <i class="fas fa-lightbulb"></i> Ví dụ: NGUYỄN lấy N, MINH lấy H → NGUYỄN MINH lấy N-H
                        </small>
                    </div>
                    
                    <div class="alert alert-pink">
                        <strong><i class="fas fa-clipboard"></i> Đã tự động thực hiện:</strong> Bước 4 đã được tự động thực hiện và lưu kết quả
                    </div>
                </div>
                
                <!-- Section 5: Text Analysis -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-language"></i> PHÂN TÍCH VĂN BẢN NÂNG CAO</h2>
                    
                    <div class="instructions">
                        <h4><i class="fas fa-info-circle"></i> Hướng dẫn phân tích văn bản:</h4>
                        <ul>
                            <li><strong>Ô 7:</strong> Văn bản để phân tích (dán từ Shoppe affiliate)</li>
                            <li><strong>Ô 8:</strong> Chữ cái để tìm (tự động từ bước 4)</li>
                            <li><strong>Ô 9:</strong> Phân tích câu và cụm từ</li>
                            <li><strong>Ô 10:</strong> Tìm chữ cái cuối từ và so sánh</li>
                            <li><strong>Ô 11:</strong> Chữ cái sau khi chuyển thành không dấu</li>
                            <li><strong>Ô 12:</strong> Hoán vị các chữ cái không dấu</li>
                            <li><strong>Ô 13:</strong> Tìm chữ cái cuối từ (không dấu)</li>
                        </ul>
                    </div>
                    
                    <!-- Tabs for Text Analysis -->
                    <div class="analysis-tabs">
                        <button class="tab-btn active" onclick="showTab('textInputTab')">
                            <i class="fas fa-font"></i> Ô 7: Nhập văn bản
                        </button>
                        <button class="tab-btn" onclick="showTab('analysisTab')">
                            <i class="fas fa-chart-bar"></i> Ô 9-13: Phân tích
                        </button>
                    </div>
                    
                    <!-- Tab 1: Text Input -->
                    <div id="textInputTab" class="tab-content active">
                        <div class="form-group">
                            <label for="textInput"><i class="fas fa-file-alt"></i> 7. Văn bản để phân tích</label>
                            <textarea id="textInput" rows="8" placeholder="Dán văn bản từ Shoppe affiliate hoặc bất kỳ văn bản nào để phân tích...">Tiếng Việt, còn gọi là tiếng Việt Nam hay Việt ngữ, là ngôn ngữ của người Việt và là ngôn ngữ chính thức tại Việt Nam. Đây là tiếng mẹ đẻ của khoảng 85% dân cư Việt Nam, cùng với hơn 4 triệu Việt kiều.</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="searchChars"><i class="fas fa-search"></i> 8. Chữ cái để tìm (tự động từ bước 4)</label>
                            <input type="text" id="searchChars" placeholder="Chữ cái sẽ tự động điền từ bước 4..." readonly>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="runTextAnalysis()">
                                <i class="fas fa-play-circle"></i> Chạy phân tích văn bản
                            </button>
                            <button class="btn btn-warning" onclick="clearTextInput()">
                                <i class="fas fa-trash-alt"></i> Xóa văn bản
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tab 2: Analysis Results -->
                    <div id="analysisTab" class="tab-content">
                        <div class="text-analysis-card">
                            <h3><i class="fas fa-chart-pie"></i> Ô 9: Phân tích câu và cụm từ</h3>
                            <div class="btn-group">
                                <button class="btn btn-info" onclick="analyzeText()">
                                    <i class="fas fa-chart-bar"></i> Phân tích văn bản
                                </button>
                            </div>
                            <div class="text-analysis-result" id="analysisResult">
                                <!-- Kết quả phân tích sẽ hiển thị ở đây -->
                            </div>
                        </div>
                        
                        <div class="text-analysis-card">
                            <h3><i class="fas fa-text-width"></i> Ô 10: Tìm chữ cái cuối từ</h3>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="findLastLetters()">
                                    <i class="fas fa-search"></i> Tìm chữ cuối từ
                                </button>
                            </div>
                            <div class="text-analysis-result" id="lastLettersResult">
                                <!-- Kết quả tìm chữ cái cuối từ sẽ hiển thị ở đây -->
                            </div>
                        </div>
                        
                        <div class="text-analysis-card">
                            <h3><i class="fas fa-exchange-alt"></i> Ô 11: Chữ cái không dấu</h3>
                            <div class="btn-group">
                                <button class="btn btn-info" onclick="convertToNoAccent()">
                                    <i class="fas fa-language"></i> Đổi thành không dấu
                                </button>
                            </div>
                            <div class="text-analysis-result" id="noAccentResult">
                                <!-- Kết quả chuyển đổi sẽ hiển thị ở đây -->
                            </div>
                        </div>
                        
                        <div class="text-analysis-card">
                            <h3><i class="fas fa-random"></i> Ô 12: Hoán vị chữ không dấu</h3>
                            <div class="btn-group">
                                <button class="btn btn-info" onclick="generateNoAccentPermutations()">
                                    <i class="fas fa-random"></i> Tạo hoán vị
                                </button>
                            </div>
                            <div class="text-analysis-result" id="noAccentPermutationResult">
                                <!-- Kết quả hoán vị sẽ hiển thị ở đây -->
                            </div>
                        </div>
                        
                        <div class="text-analysis-card">
                            <h3><i class="fas fa-text-width"></i> Ô 13: Tìm chữ cuối từ (không dấu)</h3>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="findLastLettersNoAccent()">
                                    <i class="fas fa-search"></i> Tìm chữ cuối từ
                                </button>
                            </div>
                            <div class="text-analysis-result" id="lastLettersNoAccentResult">
                                <!-- Kết quả tìm chữ cái cuối từ với chữ không dấu sẽ hiển thị ở đây -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section 6: Quick Stats -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-chart-pie"></i> THỐNG KÊ NHANH</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-box">
                            <h4><i class="fas fa-users"></i> Tổng người</h4>
                            <div class="stat-value" id="totalPeople">-</div>
                        </div>
                        
                        <div class="stat-box">
                            <h4><i class="fas fa-birthday-cake"></i> Tuổi trung bình</h4>
                            <div class="stat-value" id="avgAge">-</div>
                        </div>
                        
                        <div class="stat-box">
                            <h4><i class="fas fa-calendar-day"></i> Ngày hiện tại</h4>
                            <div class="stat-value" id="todayDisplay">-</div>
                        </div>
                        
                        <div class="stat-box">
                            <h4><i class="fas fa-search"></i> Cụm từ tìm được</h4>
                            <div class="stat-value" id="wordsSearched">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><i class="fas fa-copyright"></i> 2023 Smart Analytics Tool | Phiên bản 4.0 - Tích hợp phân tích nâng cao | Thiết kế bởi Đội ngũ phát triển</p>
        </div>
    </div>

    <script>
        // ============ PHẦN 1: HỆ THỐNG TÍNH TOÁN CƠ BẢN ============
        
        // Danh sách người dữ liệu mẫu (đã bao gồm cả dữ liệu mới)
        const peopleData = [
            // Danh sách gốc
            { id: 1, name: "NGUYỄN KHẮC NĂNG", dob: "1944-06-04" },
            { id: 2, name: "TÔ THỊ HÀ", dob: "1948-08-29" },
            { id: 3, name: "NGUYỄN MINH NAM", dob: "1971-03-03" },
            { id: 4, name: "THÂN THỊ KIM ANH", dob: "1981-09-23" },
            { id: 5, name: "NGUYỄN TÔ NGÂN AN", dob: "2014-09-28" },
            { id: 6, name: "NGUYỄN TÔ MINH CHÂU", dob: "2016-07-25" },
            { id: 7, name: "NGUYỄN TÔ BÍCH NGỌC", dob: "2020-02-05" },
            { id: 8, name: "NGUYỄN THỊ MINH HẰNG", dob: "1974-01-07" },
            { id: 9, name: "NGÔ QUÝ CƯỜNG", dob: "1973-05-23" },
            { id: 10, name: "NGÔ GIA BÁCH", dob: "2000-10-12" },
            { id: 11, name: "NGÔ GIA LINH", dob: "2005-04-05" },
            { id: 12, name: "NGUYỄN THỊ MINH PHƯƠNG", dob: "1978-11-06" },
            { id: 13, name: "HOÀNG ANH DŨNG", dob: "1978-09-21" },
            { id: 14, name: "HOÀNG HẢI VINH", dob: "2010-06-03" },
            { id: 15, name: "HOÀNG THIÊN BẠCH ANH", dob: "2015-11-14" },
            { id: 16, name: "TÔ KIM HUỆ", dob: "1960-08-09" },
            { id: 17, name: "NGUYỄN TUẤN ANH", dob: "1983-10-23" },
            { id: 18, name: "NGUYỄN THẾ ANH", dob: "2001-03-24" },
            { id: 19, name: "NGÔ THỊ MAI", dob: "1948-12-12" },
            { id: 20, name: "TÔ VIỆT HƯNG", dob: "1996-06-17" },
            { id: 21, name: "TÔ THỊ HỒNG", dob: "1964-10-10" },
            { id: 22, name: "VŨ VĂN HIỆP", dob: "1974-04-24" },
            { id: 23, name: "NGUYỄN THỊ CHI", dob: "1946-02-08" },
            { id: 24, name: "NGUYỄN TẤN BẮC", dob: "1957-11-30" },
            { id: 25, name: "NGUYỄN THỊ TÂM", dob: "1954-08-08" },
            
            // Danh sách bổ sung (các tên mới)
            { id: 26, name: "THÂN VĂN GIỮ", dob: "1955-04-18" },
            { id: 27, name: "NGUYỄN THỊ BÌNH", dob: "1958-05-21" },
            { id: 28, name: "THÂN THỊ BÍCH NGUYỆT", dob: "1980-05-21" },
            { id: 29, name: "THÂN THỊ KIM ANH", dob: "1981-09-23" },
            { id: 30, name: "THÂN VĂN TUẤN", dob: "1983-05-21" },
            { id: 31, name: "THÂN YẾN NHI", dob: "2010-03-26" },
            { id: 32, name: "LÊ THỊ PHƯƠNG", dob: "1990-06-26" },
            { id: 33, name: "NGUYỄN HOÀI NAM", dob: "2004-06-02" }
        ];
        
        // Khởi tạo các phần tử DOM cho phần tính toán cơ bản
        const currentDateInput = document.getElementById('currentDate');
        const personNameInput = document.getElementById('personName');
        const birthDateInput = document.getElementById('birthDate');
        const personListSelect = document.getElementById('personList');
        const step1ResultDiv = document.getElementById('step1Result');
        const foundPersonInfoDiv = document.getElementById('foundPersonInfo');
        const ageInput = document.getElementById('age');
        const shoppingNeedsInput = document.getElementById('shoppingNeeds');
        const lastLettersInput = document.getElementById('lastLetters');
        const totalPeopleSpan = document.getElementById('totalPeople');
        const avgAgeSpan = document.getElementById('avgAge');
        const todayDisplaySpan = document.getElementById('todayDisplay');
        const wordsSearchedSpan = document.getElementById('wordsSearched');
        
        // Biến lưu kết quả phần tính toán cơ bản
        let step1ResultIndex = -1;
        let currentPerson = null;
        let wordsSearchedCount = 0;
        
        // ============ PHẦN 2: HỆ THỐNG PHÂN TÍCH VĂN BẢN ============
        
        // Bảng chuyển đổi chữ có dấu sang không dấu
        const accentMap = {
            'A': 'A', 'Ă': 'A', 'Â': 'A', 'B': 'B', 'C': 'C', 'D': 'D', 'Đ': 'Đ', 'E': 'E', 'Ê': 'E',
            'G': 'G', 'H': 'H', 'I': 'I', 'K': 'K', 'L': 'L', 'M': 'M', 'N': 'N', 'O': 'O', 'Ô': 'O',
            'Ơ': 'O', 'P': 'P', 'Q': 'Q', 'R': 'R', 'S': 'S', 'T': 'T', 'U': 'U', 'Ư': 'U', 'V': 'V',
            'X': 'X', 'Y': 'Y', 'À': 'A', 'Á': 'A', 'Ả': 'A', 'Ã': 'A', 'Ạ': 'A', 'Ằ': 'A', 'Ắ': 'A',
            'Ẳ': 'A', 'Ẵ': 'A', 'Ặ': 'A', 'Ầ': 'A', 'Ấ': 'A', 'Ẩ': 'A', 'Ẫ': 'A', 'Ậ': 'A', 'È': 'E',
            'É': 'E', 'Ẻ': 'E', 'Ẽ': 'E', 'Ẹ': 'E', 'Ề': 'E', 'Ế': 'E', 'Ể': 'E', 'Ễ': 'E', 'Ệ': 'E',
            'Ì': 'I', 'Í': 'I', 'Ỉ': 'I', 'Ĩ': 'I', 'Ị': 'I', 'Ò': 'O', 'Ó': 'O', 'Ỏ': 'O', 'Õ': 'O',
            'Ọ': 'O', 'Ồ': 'O', 'Ố': 'O', 'Ổ': 'O', 'Ỗ': 'O', 'Ộ': 'O', 'Ờ': 'O', 'Ớ': 'O', 'Ở': 'O',
            'Ỡ': 'O', 'Ợ': 'O', 'Ù': 'U', 'Ú': 'U', 'Ủ': 'U', 'Ũ': 'U', 'Ụ': 'U', 'Ừ': 'U', 'Ứ': 'U',
            'Ử': 'U', 'Ữ': 'U', 'Ự': 'U', 'Ỳ': 'Y', 'Ý': 'Y', 'Ỷ': 'Y', 'Ỹ': 'Y', 'Ỵ': 'Y',
            'a': 'a', 'ă': 'a', 'â': 'a', 'b': 'b', 'c': 'c', 'd': 'd', 'đ': 'đ', 'e': 'e', 'ê': 'e',
            'g': 'g', 'h': 'h', 'i': 'i', 'k': 'k', 'l': 'l', 'm': 'm', 'n': 'n', 'o': 'o', 'ô': 'o',
            'ơ': 'o', 'p': 'p', 'q': 'q', 'r': 'r', 's': 's', 't': 't', 'u': 'u', 'ư': 'u', 'v': 'v',
            'x': 'x', 'y': 'y', 'à': 'a', 'á': 'a', 'ả': 'a', 'ã': 'a', 'ạ': 'a', 'ằ': 'a', 'ắ': 'a',
            'ẳ': 'a', 'ẵ': 'a', 'ặ': 'a', 'ầ': 'a', 'ấ': 'a', 'ẩ': 'a', 'ẫ': 'a', 'ậ': 'a', 'è': 'e',
            'é': 'e', 'ẻ': 'e', 'ẽ': 'e', 'ẹ': 'e', 'ề': 'e', 'ế': 'e', 'ể': 'e', 'ễ': 'e', 'ệ': 'e',
            'ì': 'i', 'í': 'i', 'ỉ': 'i', 'ĩ': 'i', 'ị': 'i', 'ò': 'o', 'ó': 'o', 'ỏ': 'o', 'õ': 'o',
            'ọ': 'o', 'ồ': 'o', 'ố': 'o', 'ổ': 'o', 'ỗ': 'o', 'ộ': 'o', 'ờ': 'o', 'ớ': 'o', 'ở': 'o',
            'ỡ': 'o', 'ợ': 'o', 'ù': 'u', 'ú': 'u', 'ủ': 'u', 'ũ': 'u', 'ụ': 'u', 'ừ': 'u', 'ứ': 'u',
            'ử': 'u', 'ữ': 'u', 'ự': 'u', 'ỳ': 'y', 'ý': 'y', 'ỷ': 'y', 'ỹ': 'y', 'ỵ': 'y'
        };
        
        // ============ HÀM CHUNG ============
        
        // Định dạng ngày tháng để hiển thị
        function formatDateDisplay(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }
        
        // Hiển thị thông báo
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${type === 'success' ? '#2ecc71' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                transition: opacity 0.3s;
                opacity: 0;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 10);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        // Chuyển tab hiển thị
        function showTab(tabId) {
            // Ẩn tất cả tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Xóa active của tất cả tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hiển thị tab được chọn
            document.getElementById(tabId).classList.add('active');
            
            // Thêm active cho tab button tương ứng
            event.currentTarget.classList.add('active');
        }
        
        // ============ HÀM PHẦN TÍNH TOÁN CƠ BẢN ============
        
        // Hiển thị thông tin người được tìm thấy
        function displayFoundPerson(person) {
            foundPersonInfoDiv.innerHTML = `
                <div class="person-info">
                    <h3><i class="fas fa-user-check"></i> Người được chọn theo kết quả tính toán</h3>
                    <p><i class="fas fa-id-card"></i> <strong>Tên:</strong> ${person.name}</p>
                    <p><i class="fas fa-calendar-day"></i> <strong>Ngày sinh:</strong> ${formatDateDisplay(person.dob)}</p>
                    <p><i class="fas fa-hashtag"></i> <strong>ID trong danh sách:</strong> ${person.id}</p>
                </div>
            `;
            
            // Cập nhật thông tin vào các input
            personNameInput.value = person.name;
            birthDateInput.value = person.dob;
            currentPerson = person;
        }
        
        // Hàm xác định nhu cầu mua hàng theo tuổi
        function determineShoppingNeeds(age) {
            let needs = [];
            
            // Hoa hồng EXTRA
            if (age >= 18) {
                needs.push("Nhà cửa và đời sống", "Đồ chơi, ôtô & xe máy & xe đạp", "Nhà sách online", 
                          "Chăm sóc thú cưng", "Túi ví nữ", "Thiết bị điện gia dụng", 
                          "Thể thao du lịch dụng cụ và thiết bị tiện ích");
            }
            
            if (age >= 16 && age <= 40) {
                needs.push("Mẹ & Bé", "Sắc đẹp", "Giày dép nữ");
            }
            
            // Hoa hồng Shoppee
            if (age >= 13 && age <= 25) {
                needs.push("Thời trang nữ", "Sắc đẹp", "Thời trang trẻ em", "Xu hướng");
            }
            
            if (age >= 18 && age <= 40) {
                needs.push("Mẹ và bé", "Áo dài", "Phụ kiện thể thao");
            }
            
            if (age >= 16 && age <= 50) {
                needs.push("Thời trang nam", "Thời trang nữ");
            }
            
            // Loại bỏ các giá trị trùng lặp
            needs = [...new Set(needs)];
            
            return needs.join(", ");
        }
        
        // Tính tuổi trung bình
        function calculateAverageAge() {
            let totalAge = 0;
            const currentDate = new Date(currentDateInput.value);
            
            if (isNaN(currentDate.getTime())) {
                return 0;
            }
            
            let validPeople = 0;
            
            peopleData.forEach(person => {
                const birthDate = new Date(person.dob);
                if (isNaN(birthDate.getTime())) return;
                
                let age = currentDate.getFullYear() - birthDate.getFullYear();
                const monthDiff = currentDate.getMonth() - birthDate.getMonth();
                const dayDiff = currentDate.getDate() - birthDate.getDate();
                
                if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
                    age--;
                }
                
                totalAge += age;
                validPeople++;
            });
            
            return validPeople > 0 ? Math.round(totalAge / validPeople) : 0;
        }
        
        // Đổ dữ liệu vào danh sách chọn
        function populatePersonList() {
            personListSelect.innerHTML = '<option value="">-- Chọn một người --</option>';
            
            peopleData.forEach(person => {
                const option = document.createElement('option');
                option.value = person.id;
                option.textContent = `${person.name} (${formatDateDisplay(person.dob)})`;
                personListSelect.appendChild(option);
            });
        }
        
        // Xử lý khi chọn người từ danh sách
        personListSelect.addEventListener('change', function() {
            const selectedId = parseInt(this.value);
            if (selectedId) {
                const selectedPerson = peopleData.find(person => person.id === selectedId);
                if (selectedPerson) {
                    personNameInput.value = selectedPerson.name;
                    birthDateInput.value = selectedPerson.dob;
                    currentPerson = selectedPerson;
                    
                    // Hiển thị thông tin người được chọn
                    displayFoundPerson(selectedPerson);
                }
            } else {
                foundPersonInfoDiv.innerHTML = '';
                currentPerson = null;
            }
        });
        
        // Bước 1: Tính toán từ ngày hiện tại
        function performStep1() {
            const currentDateValue = currentDateInput.value;
            if (!currentDateValue) {
                alert("⚠️ Vui lòng chọn ngày hiện tại trước khi thực hiện phân tích");
                return false;
            }
            
            const currentDate = new Date(currentDateValue);
            if (isNaN(currentDate.getTime())) {
                alert("⚠️ Ngày hiện tại không hợp lệ");
                return false;
            }
            
            const baseDate = new Date('1900-01-01');
            
            // Tính số ngày chênh lệch
            const timeDiff = currentDate.getTime() - baseDate.getTime();
            const dayDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
            
            // Tính A mod tổng số người
            const totalPeople = peopleData.length;
            step1ResultIndex = dayDiff % totalPeople;
            
            // Tìm người tương ứng với chỉ số (chỉ số bắt đầu từ 0)
            const foundPerson = peopleData[step1ResultIndex];
            
            // Hiển thị kết quả
            step1ResultDiv.innerHTML = `
                <h3><i class="fas fa-chart-bar"></i> Kết quả tính toán bước 1</h3>
                <p><i class="far fa-calendar-alt"></i> <strong>Ngày hiện tại:</strong> <span class="highlight">${formatDateDisplay(currentDateValue)}</span></p>
                <p><i class="fas fa-calculator"></i> <strong>Số ngày từ 01/01/1900:</strong> <span class="highlight">${dayDiff}</span> ngày</p>
                <p><i class="fas fa-users"></i> <strong>Tổng số người trong danh sách:</strong> <span class="highlight">${totalPeople}</span></p>
                <p><i class="fas fa-percentage"></i> <strong>Kết quả tính toán:</strong> ${dayDiff} mod ${totalPeople} = <span class="highlight">${step1ResultIndex}</span></p>
                <p><i class="fas fa-user-tie"></i> <strong>Người tương ứng (ID ${step1ResultIndex + 1}):</strong> <span class="highlight">${foundPerson ? foundPerson.name : "Không tìm thấy"}</span></p>
            `;
            
            // Hiển thị thông tin người được tìm thấy
            if (foundPerson) {
                displayFoundPerson(foundPerson);
                
                // Tự động chọn người này trong dropdown
                personListSelect.value = foundPerson.id;
            }
            
            return true;
        }
        
        // Bước 2 & 3: Tính tuổi và nhu cầu mua hàng
        function performStep2_3() {
            if (!currentPerson) {
                alert("⚠️ Không tìm thấy thông tin người để tính tuổi");
                return false;
            }
            
            const currentDateValue = currentDateInput.value;
            const birthDateValue = currentPerson.dob;
            
            const currentDate = new Date(currentDateValue);
            const birthDate = new Date(birthDateValue);
            
            if (isNaN(currentDate.getTime()) || isNaN(birthDate.getTime())) {
                alert("⚠️ Ngày tháng không hợp lệ");
                return false;
            }
            
            // Tính tuổi
            let age = currentDate.getFullYear() - birthDate.getFullYear();
            const monthDiff = currentDate.getMonth() - birthDate.getMonth();
            const dayDiff = currentDate.getDate() - birthDate.getDate();
            
            if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
                age--;
            }
            
            if (age < 0) age = 0;
            
            ageInput.value = age + " tuổi";
            
            // Xác định nhu cầu mua hàng dựa trên tuổi
            let shoppingNeeds = determineShoppingNeeds(age);
            shoppingNeedsInput.value = shoppingNeeds;
            
            return true;
        }
        
        // Bước 4: Lấy các chữ cái cuối trong tên
        function performStep4() {
            if (!currentPerson) {
                alert("⚠️ Không tìm thấy thông tin người để phân tích tên");
                return false;
            }
            
            const fullName = currentPerson.name.trim().toUpperCase();
            
            // Tách tên thành các từ
            const nameParts = fullName.split(' ').filter(part => part.length > 0);
            
            if (nameParts.length === 0) {
                alert("⚠️ Tên không hợp lệ");
                return false;
            }
            
            // Lấy chữ cái cuối của mỗi từ
            const lastLetters = nameParts.map(part => {
                // Lấy chữ cái cuối cùng (không phải dấu cách)
                const cleanPart = part.replace(/\s/g, '');
                return cleanPart.length > 0 ? cleanPart.charAt(cleanPart.length - 1) : '';
            }).filter(char => char.length > 0);
            
            // Kết hợp các chữ cái với dấu gạch ngang
            const lastLettersResult = lastLetters.join('-');
            
            lastLettersInput.value = lastLettersResult;
            
            // Cập nhật ô 8 (chữ cái để tìm) với kết quả từ bước 4
            document.getElementById('searchChars').value = lastLetters.join(' ');
            
            return true;
        }
        
        // ============ HÀM PHẦN PHÂN TÍCH VĂN BẢN ============
        
        // Xóa văn bản ở ô 7
        function clearTextInput() {
            document.getElementById('textInput').value = '';
            showNotification('Đã xóa văn bản ở ô 7');
        }
        
        // Hàm tạo tất cả hoán vị của một mảng
        function getPermutations(arr) {
            const result = [];
            
            function permute(current, remaining) {
                if (remaining.length === 0) {
                    result.push([...current]);
                    return;
                }
                
                for (let i = 0; i < remaining.length; i++) {
                    current.push(remaining[i]);
                    const newRemaining = [...remaining.slice(0, i), ...remaining.slice(i + 1)];
                    permute(current, newRemaining);
                    current.pop();
                }
            }
            
            permute([], arr);
            return result;
        }
        
        // Hàm phân tích văn bản (ô 9)
        function analyzeText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 7', 'error');
                return;
            }

            // Tách văn bản thành các câu dựa trên dấu câu
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '<ol>';
            let counter = 1;
            
            sentences.forEach(sentence => {
                const trimmedSentence = sentence.trim();
                // Kiểm tra nếu câu dài hơn 10 từ hoặc 30 ký tự
                const wordCount = trimmedSentence.split(/\s+/).length;
                const charCount = trimmedSentence.length;
                
                if (wordCount > 10 || charCount > 30) {
                    resultHTML += `<li><strong>Câu ${counter}:</strong> ${trimmedSentence} <br><span class="text-highlight">(${wordCount} từ, ${charCount} ký tự)</span></li>`;
                    counter++;
                }
            });
            
            if (counter === 1) {
                resultHTML += '<li>Không có câu nào đủ điều kiện (lớn hơn 10 từ hoặc 30 ký tự)</li>';
            }
            
            resultHTML += '</ol>';
            document.getElementById('analysisResult').innerHTML = resultHTML;
            
            showNotification(`Đã phân tích ${counter-1} câu`);
        }
        
        // Hàm tìm chữ cái cuối mỗi từ (ô 10)
        function findLastLetters() {
            const text = document.getElementById('textInput').value.trim();
            const searchChars = document.getElementById('searchChars').value.trim().split(' ').filter(c => c.trim() !== '');
            
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 7', 'error');
                return;
            }
            
            if (searchChars.length === 0) {
                showNotification('Vui lòng nhập chữ cái cần tìm ở ô 8', 'error');
                return;
            }
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '';
            let totalMatches = 0;
            
            sentences.forEach((sentence, idx) => {
                const trimmedSentence = sentence.trim();
                const words = trimmedSentence.split(/\s+/).filter(w => w.length > 0);
                const lastLetters = words.map(word => {
                    // Lấy chữ cái cuối cùng, giữ nguyên dấu
                    return word.charAt(word.length - 1);
                });
                
                // Đếm số lần xuất hiện của các chữ cái cần tìm
                const matchCount = lastLetters.filter(letter => 
                    searchChars.some(searchChar => searchChar === letter)
                ).length;
                
                if (matchCount >= 3) {
                    totalMatches++;
                    let highlightedSentence = trimmedSentence;
                    
                    // Tô màu các chữ cái trùng khớp
                    searchChars.forEach(char => {
                        const regex = new RegExp(`(${char})(?![^<]*>)`, 'gi');
                        highlightedSentence = highlightedSentence.replace(regex, '<span class="text-highlight">$1</span>');
                    });
                    
                    resultHTML += `<p><strong>Dòng ${idx+1}:</strong> ${highlightedSentence}</p>`;
                    resultHTML += `<p><em>Chữ cái cuối mỗi từ:</em> ${lastLetters.join(', ')}</p>`;
                    resultHTML += `<p><span class="text-highlight">Tìm thấy ${matchCount} chữ cái trùng với "${searchChars.join(', ')}"</span></p><hr>`;
                }
            });
            
            if (totalMatches === 0) {
                resultHTML = '<p>Không tìm thấy dòng nào có ít nhất 3 chữ cái cuối từ trùng với chữ cái tìm kiếm.</p>';
            } else {
                resultHTML = `<p><strong>Tìm thấy ${totalMatches} dòng có ít nhất 3 chữ cái cuối từ trùng khớp:</strong></p>` + resultHTML;
            }
            
            document.getElementById('lastLettersResult').innerHTML = resultHTML;
            showNotification(`Đã tìm thấy ${totalMatches} dòng phù hợp`);
        }
        
        // Hàm chuyển chữ có dấu thành không dấu (ô 11)
        function convertToNoAccent() {
            const searchChars = document.getElementById('searchChars').value.trim();
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái ở ô 8', 'error');
                return;
            }
            
            let result = '';
            for (let char of searchChars) {
                result += accentMap[char] || char;
            }
            
            document.getElementById('noAccentResult').innerHTML = `
                <p><strong>Chữ cái gốc:</strong> ${searchChars}</p>
                <p><strong>Chữ cái không dấu:</strong> ${result}</p>
                <p><strong>Chi tiết chuyển đổi:</strong></p>
                <ul>
                    ${Array.from(searchChars).filter(c => c !== ' ').map(char => 
                        `<li>${char} → ${accentMap[char] || char}</li>`
                    ).join('')}
                </ul>
            `;
            
            showNotification('Đã chuyển đổi chữ có dấu thành không dấu');
        }
        
        // Hàm tạo hoán vị cho chữ không dấu (ô 12)
        function generateNoAccentPermutations() {
            const searchChars = document.getElementById('searchChars').value.trim();
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái ở ô 8', 'error');
                return;
            }
            
            // Chuyển đổi sang không dấu
            let noAccentChars = '';
            for (let char of searchChars) {
                if (char !== ' ') {
                    noAccentChars += accentMap[char] || char;
                }
            }
            
            const chars = noAccentChars.split('').filter(c => c.trim() !== '');
            const maxChars = Math.min(chars.length, 3);
            const selectedChars = chars.slice(0, maxChars);
            
            if (selectedChars.length === 0) {
                showNotification('Không có chữ cái hợp lệ để tạo hoán vị', 'error');
                return;
            }

            const permutations = getPermutations(selectedChars);
            let resultHTML = `<p><strong>Hoán vị của "${selectedChars.join(' ')}" (không dấu):</strong></p><ol>`;
            
            permutations.forEach(perm => {
                resultHTML += `<li>${perm.join(' ')}</li>`;
            });
            
            resultHTML += `</ol><p>Tổng cộng: ${permutations.length} hoán vị</p>`;
            document.getElementById('noAccentPermutationResult').innerHTML = resultHTML;
            
            showNotification(`Đã tạo ${permutations.length} hoán vị không dấu`);
        }
        
        // Hàm tìm chữ cái cuối mỗi từ với chữ không dấu (ô 13)
        function findLastLettersNoAccent() {
            const text = document.getElementById('textInput').value.trim();
            const searchChars = document.getElementById('searchChars').value.trim();
            
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 7', 'error');
                return;
            }
            
            if (!searchChars) {
                showNotification('Vui lòng nhập chữ cái cần tìm ở ô 8', 'error');
                return;
            }
            
            // Chuyển đổi chữ tìm kiếm sang không dấu
            let noAccentSearchChars = '';
            for (let char of searchChars) {
                if (char !== ' ') {
                    noAccentSearchChars += accentMap[char] || char;
                }
            }
            
            const searchCharsArray = noAccentSearchChars.split('').filter(c => c.trim() !== '');
            
            const sentences = text.split(/[.!?]+/).filter(s => s.trim() !== '');
            let resultHTML = '';
            let totalMatches = 0;
            
            sentences.forEach((sentence, idx) => {
                const trimmedSentence = sentence.trim();
                const words = trimmedSentence.split(/\s+/).filter(w => w.length > 0);
                const lastLetters = words.map(word => {
                    // Lấy chữ cái cuối cùng và chuyển sang không dấu
                    const lastChar = word.charAt(word.length - 1);
                    return accentMap[lastChar] || lastChar;
                });
                
                // Đếm số lần xuất hiện của các chữ cái cần tìm (không dấu)
                const matchCount = lastLetters.filter(letter => 
                    searchCharsArray.some(searchChar => searchChar === letter)
                ).length;
                
                if (matchCount >= 3) {
                    totalMatches++;
                    let highlightedSentence = trimmedSentence;
                    
                    // Tô màu các từ có chữ cái cuối trùng khớp (sau khi chuyển sang không dấu)
                    words.forEach(word => {
                        const lastChar = word.charAt(word.length - 1);
                        const lastCharNoAccent = accentMap[lastChar] || lastChar;
                        
                        if (searchCharsArray.includes(lastCharNoAccent)) {
                            const regex = new RegExp(`\\b${word}\\b`, 'g');
                            highlightedSentence = highlightedSentence.replace(regex, `<span class="text-highlight">${word}</span>`);
                        }
                    });
                    
                    resultHTML += `<p><strong>Dòng ${idx+1}:</strong> ${highlightedSentence}</p>`;
                    resultHTML += `<p><em>Chữ cái cuối mỗi từ (không dấu):</em> ${lastLetters.join(', ')}</p>`;
                    resultHTML += `<p><span class="text-highlight">Tìm thấy ${matchCount} chữ cái trùng với "${searchCharsArray.join(', ')}" (không dấu)</span></p><hr>`;
                }
            });
            
            if (totalMatches === 0) {
                resultHTML = '<p>Không tìm thấy dòng nào có ít nhất 3 chữ cái cuối từ trùng với chữ cái tìm kiếm (không dấu).</p>';
            } else {
                resultHTML = `<p><strong>Tìm thấy ${totalMatches} dòng có ít nhất 3 chữ cái cuối từ trùng khớp (không dấu):</strong></p>` + resultHTML;
            }
            
            document.getElementById('lastLettersNoAccentResult').innerHTML = resultHTML;
            showNotification(`Đã tìm thấy ${totalMatches} dòng phù hợp (không dấu)`);
        }
        
        // Chạy toàn bộ phân tích văn bản
        function runTextAnalysis() {
            // Kiểm tra văn bản
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showNotification('Vui lòng nhập văn bản ở ô 7', 'error');
                return;
            }
            
            // Kiểm tra chữ cái tìm kiếm
            const searchChars = document.getElementById('searchChars').value.trim();
            if (!searchChars) {
                showNotification('Chưa có chữ cái để tìm kiếm. Hãy chạy "Tự động phân tích" trước.', 'error');
                return;
            }
            
            // Chuyển sang tab phân tích
            showTab('analysisTab');
            
            // Chạy tất cả các phân tích
            setTimeout(() => analyzeText(), 100);
            setTimeout(() => findLastLetters(), 200);
            setTimeout(() => convertToNoAccent(), 300);
            setTimeout(() => generateNoAccentPermutations(), 400);
            setTimeout(() => findLastLettersNoAccent(), 500);
            
            showNotification('Đang chạy toàn bộ phân tích văn bản...');
        }
        
        // ============ HÀM CHÍNH CHẠY TẤT CẢ ============
        
        // Hàm tự động phân tích tất cả bước
        async function performAutoAnalysis() {
            // 1. Thực hiện bước 1
            if (!performStep1()) return;
            
            // Thêm độ trễ
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // 2. Thực hiện bước 2-3
            if (!performStep2_3()) return;
            
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // 3. Thực hiện bước 4
            if (!performStep4()) return;
            
            // Chuyển sang tab phân tích văn bản
            showTab('textInputTab');
            
            // Hiển thị thông báo thành công
            setTimeout(() => {
                showNotification('✅ Phân tích cơ bản hoàn thành! Vui lòng dán văn bản và chạy phân tích văn bản.');
            }, 500);
        }
        
        // Đặt lại tất cả
        function resetAll() {
            // Reset phần tính toán cơ bản
            const today = new Date();
            const formattedToday = today.toISOString().split('T')[0];
            currentDateInput.value = formattedToday;
            personListSelect.value = "";
            personNameInput.value = "";
            birthDateInput.value = "";
            ageInput.value = "";
            shoppingNeedsInput.value = "";
            lastLettersInput.value = "";
            step1ResultDiv.innerHTML = `
                <h3><i class="fas fa-chart-bar"></i> Kết quả tính toán</h3>
                <p>Kết quả sẽ hiển thị ở đây sau khi thực hiện bước 1</p>
            `;
            foundPersonInfoDiv.innerHTML = "";
            
            // Reset phần phân tích văn bản
            document.getElementById('textInput').value = "Tiếng Việt, còn gọi là tiếng Việt Nam hay Việt ngữ, là ngôn ngữ của người Việt và là ngôn ngữ chính thức tại Việt Nam. Đây là tiếng mẹ đẻ của khoảng 85% dân cư Việt Nam, cùng với hơn 4 triệu Việt kiều.";
            document.getElementById('searchChars').value = "";
            document.getElementById('analysisResult').innerHTML = "";
            document.getElementById('lastLettersResult').innerHTML = "";
            document.getElementById('noAccentResult').innerHTML = "";
            document.getElementById('noAccentPermutationResult').innerHTML = "";
            document.getElementById('lastLettersNoAccentResult').innerHTML = "";
            
            // Chuyển về tab nhập văn bản
            showTab('textInputTab');
            
            // Reset biến
            step1ResultIndex = -1;
            currentPerson = null;
            wordsSearchedCount = 0;
            wordsSearchedSpan.textContent = "0";
            
            showNotification('✅ Đã đặt lại tất cả thông tin. Bạn có thể bắt đầu phân tích mới.');
        }
        
        // Khởi tạo trang
        function initPage() {
            // Đặt ngày hiện tại
            const today = new Date();
            const formattedToday = today.toISOString().split('T')[0];
            currentDateInput.value = formattedToday;
            
            populatePersonList();
            
            // Hiển thị thông tin thống kê
            totalPeopleSpan.textContent = peopleData.length;
            
            // Tính và hiển thị tuổi trung bình
            const avgAge = calculateAverageAge();
            avgAgeSpan.textContent = avgAge > 0 ? avgAge + " tuổi" : "-";
            
            // Hiển thị ngày hiện tại
            todayDisplaySpan.textContent = formatDateDisplay(formattedToday);
            
            // Gán sự kiện cho nút
            document.getElementById('btnAutoAnalyze').addEventListener('click', performAutoAnalysis);
            document.getElementById('btnReset').addEventListener('click', resetAll);
            
            // Khởi tạo giá trị mặc định cho ô tìm kiếm
            document.getElementById('searchChars').value = "A Ă Â";
            
            showNotification('Hệ thống đã sẵn sàng! Chọn ngày, chọn người và nhấn "Tự động phân tích".');
        }
        
        // Gọi hàm khởi tạo khi trang tải xong
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>