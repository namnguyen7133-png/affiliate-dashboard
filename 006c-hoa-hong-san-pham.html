<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·ªô L·ªçc ∆Øu ƒê√£i Shop - Nam Nguy·ªÖn</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h2 { color: #ee4d2d; text-align: center; border-bottom: 2px solid #ee4d2d; padding-bottom: 10px; margin-bottom: 20px; }
        
        .filter-section { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; background: #fff5f2; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-bottom: 8px; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        .btn-process { background: #ee4d2d; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn-process:hover { background: #d73d1d; }

        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #333; color: white; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-card b { display: block; font-size: 22px; color: #ffbe00; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th { background: #f8f9fa; padding: 12px; border: 1px solid #eee; text-align: left; }
        td { padding: 12px; border: 1px solid #eee; }
        .hh-value { color: #ee4d2d; font-weight: bold; font-size: 15px; }
        .shop-name { font-weight: bold; color: #222; }
        .link-short { color: #0066cc; text-decoration: none; font-weight: bold; word-break: break-all; }
        .link-short:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>üè™ B·ªò L·ªåC ∆ØU ƒê√ÉI SHOP (BONUS)</h2>
    
    <div class="filter-section">
        <div>
            <label>1. Ch·ªçn t·ªáp CSV (∆Øu ƒë√£i Shop):</label>
            <input type="file" id="csvFile" accept=".csv">
        </div>
        <div>
            <label>2. L·ªçc m·ª©c hoa h·ªìng:</label>
            <select id="rangeHH">
                <option value="0">T·∫•t c·∫£</option>
                <option value="10">T·ª´ 10% tr·ªü l√™n</option>
                <option value="15">T·ª´ 15% tr·ªü l√™n</option>
                <option value="18">T·ª´ 18% tr·ªü l√™n</option>
            </select>
        </div>
    </div>

    <button class="btn-process" onclick="processBonusData()">PH√ÇN T√çCH ∆ØU ƒê√ÉI</button>

    <div id="output" style="margin-top:20px;">
        <div id="statArea" class="stat-grid"></div>
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th>T√™n Shop</th>
                    <th>% Hoa h·ªìng</th>
                    <th>Link r√∫t g·ªçn (S.shopee)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    function parseCSVLine(line) {
        const result = [];
        let cur = '', inQuote = false;
        for (let char of line) {
            if (char === '"') inQuote = !inQuote;
            else if (char === ',' && !inQuote) { result.push(cur); cur = ''; }
            else cur += char;
        }
        result.push(cur);
        return result;
    }

    function processBonusData() {
        const fileInput = document.getElementById('csvFile');
        const minFilter = parseFloat(document.getElementById('rangeHH').value);
        if (!fileInput.files[0]) return alert("Vui l√≤ng ch·ªçn file CSV!");

        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            let rowsHtml = '';
            let cTotal = 0, cHigh = 0, cMedium = 0;

            lines.forEach((line, i) => {
                if (i === 0 || !line.trim()) return;
                const cols = parseCSVLine(line);
                
                if (cols.length >= 5) {
                    const shopName = cols[0];
                    // B√≥c t√°ch s·ªë t·ª´ chu·ªói "L√™n ƒë·∫øn 17,5%"
                    let hhRaw = cols[2].replace('L√™n ƒë·∫øn ', '').replace('%', '').replace('"', '').replace(',', '.');
                    const hhValue = parseFloat(hhRaw);
                    const shortLink = cols[4].trim();

                    if (!isNaN(hhValue)) {
                        cTotal++;
                        if (hhValue >= 15) cHigh++;
                        else if (hhValue >= 10) cMedium++;

                        if (hhValue >= minFilter) {
                            rowsHtml += `<tr>
                                <td class="shop-name">${shopName}</td>
                                <td class="hh-value">${hhValue}%</td>
                                <td><a href="${shortLink}" target="_blank" class="link-short">${shortLink}</a></td>
                            </tr>`;
                        }
                    }
                }
            });

            document.getElementById('statArea').innerHTML = `
                <div class="stat-card">T·ªïng Shop<b>${cTotal}</b></div>
                <div class="stat-card">T·ª´ 10% - 15%<b>${cMedium}</b></div>
                <div class="stat-card">Tr√™n 15%<b>${cHigh}</b></div>
            `;

            document.getElementById('resultBody').innerHTML = rowsHtml;
            document.getElementById('resultTable').style.display = 'table';
        };
        reader.readAsText(fileInput.files[0]);
    }
</script>

</body>
</html>