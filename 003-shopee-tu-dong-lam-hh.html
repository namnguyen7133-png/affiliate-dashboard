<div class="percentage-controls">
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n T√≠ch Shopee Affiliate</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f4f6f8 0%, #e9edf0 100%);
            margin: 0;
            padding: 20px;
            max-width: 1400px;
            margin: auto;
            color: #333;
        }
        
        header {
            background: linear-gradient(to right, #ff5722, #ee4d2d);
            padding: 25px 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(238, 77, 45, 0.2);
            color: white;
        }
        
        header h1 {
            margin: 0;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        header p {
            margin: 10px 0 0;
            opacity: 0.9;
        }
        
        .analysis-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            font-size: 18px;
            color: #ff5722;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .percentage-input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
        }
        
        .percentage-input-title {
            font-size: 16px;
            font-weight: 600;
            color: #28a745;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .percentage-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .percentage-input-container {
            flex: 1;
            min-width: 200px;
        }
        
        .percentage-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .percentage-input {
            flex: 1;
            padding: 12px 15px;
            font-size: 16px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .percentage-input:focus {
            outline: none;
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
        }
        
        .percentage-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .percentage-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-btn {
            background: #28a745;
            color: white;
        }
        
        .add-btn:hover {
            background: #218838;
        }
        
        .clear-btn {
            background: #dc3545;
            color: white;
        }
        
        .clear-btn:hover {
            background: #c82333;
        }
        
        .preset-btn {
            background: #007bff;
            color: white;
        }
        
        .preset-btn:hover {
            background: #0056b3;
        }
        
        .percentages-display {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .percentages-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .percentage-tag {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .remove-percent {
            cursor: pointer;
            color: #dc3545;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .mode-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #e0e0e0;
        }
        
        .mode-option:hover {
            background: #f0f0f0;
        }
        
        .mode-option.active {
            background: #e6f7ff;
            border-color: #007bff;
        }
        
        .mode-option input {
            margin: 0;
            cursor: pointer;
        }
        
        .input-container {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 14px 16px;
            font-size: 16px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #ff5722;
            box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.2);
        }
        
        .percent-analysis-container {
            margin: 25px 0;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 10px;
            border-left: 5px solid #007bff;
        }
        
        .percent-analysis-title {
            font-size: 16px;
            font-weight: 600;
            color: #007bff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .percent-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .percent-stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        
        .percent-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff5722;
            text-align: center;
        }
        
        .percent-label {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
        
        .percent-bar-container {
            margin-top: 10px;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .percent-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 5px;
            transition: width 1s ease;
        }
        
        .url-input-container {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        
        .file-input-container {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 2px dashed #ccc;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .file-input-container:hover {
            border-color: #ff5722;
            background: #fff5f2;
        }
        
        .file-input-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: #666;
        }
        
        .file-input-icon {
            font-size: 24px;
            color: #ff5722;
        }
        
        .file-input-text {
            font-size: 14px;
        }
        
        #fileInfo, #urlInfo {
            margin-top: 10px;
            font-size: 14px;
            color: #28a745;
            font-weight: 500;
        }
        
        .buttons-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }
        
        .primary-btn {
            background: linear-gradient(to right, #ff5722, #ee4d2d);
            color: white;
        }
        
        .primary-btn:hover {
            background: linear-gradient(to right, #e64a19, #d84315);
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.3);
        }
        
        .secondary-btn {
            background: #f1f1f1;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .secondary-btn:hover {
            background: #e0e0e0;
        }
        
        .tertiary-btn {
            background: #007bff;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            flex: none;
        }
        
        .tertiary-btn:hover {
            background: #0056b3;
        }
        
        #offers-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .offer-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #f0f0f0;
        }
        
        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .offer-card h3 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .commission {
            font-weight: bold;
            color: #28a745;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .category {
            color: #666;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .links {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .links a {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .primary-link {
            background: #ff5722;
            color: #fff;
        }
        
        .primary-link:hover {
            background: #e64a19;
        }
        
        .secondary-link {
            background: #f1f1f1;
            color: #333;
            border: 1px solid #ccc;
        }
        
        .secondary-link:hover {
            background: #e0e0e0;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff5722;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff5722;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .commission-filter {
            margin: 15px 0;
            padding: 15px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 1px solid #cce5ff;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .filter-option {
            padding: 8px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .filter-option:hover {
            background: #e6f7ff;
            border-color: #007bff;
        }
        
        .filter-option.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .info-text {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            #offers-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .percent-stats {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                justify-content: center;
            }
            
            .percentage-controls {
                flex-direction: column;
            }
            
            .percentage-input-container {
                min-width: 100%;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>üîç Ph√¢n T√≠ch Shopee Affiliate</h1>
        <p>Nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm ri√™ng v√† ph√¢n t√≠ch d·ªØ li·ªáu CSV</p>
    </header>
    
    <div class="analysis-section">
        <!-- PH·∫¶N NH·∫¨P T·ª∂ L·ªÜ PH·∫¶N TRƒÇM -->
        <div class="percentage-input-section">
            <div class="percentage-input-title">
                <span>üìä</span> Nh·∫≠p T·ª∑ L·ªá Ph·∫ßn TrƒÉm ƒê·ªÉ Ph√¢n T√≠ch
            </div>
            
            <div class="info-text">
                üí° <strong>106</strong> l√† t·ªïng s·ªë l∆∞·ª£ng ƒë√£ b√°n ƒë∆∞·ª£c t·ª´ t·∫•t c·∫£ c√°c t·ª∑ l·ªá ph·∫ßn trƒÉm
            </div>
            
            <div class="percentage-controls"> 
			<div class="input-container">
    <label class="input-label">üì¶ Nh·∫≠p s·ªë l∆∞·ª£ng s·∫£n ph·∫©m ƒë√£ b√°n:</label>
    <div class="input-group">
        <input type="number" id="soldInput" min="0" placeholder="V√≠ d·ª•: 106">
    </div>
</div>

                <div class="percentage-input-container">
                    <div class="input-label">Nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm (c√°ch nhau b·∫±ng d·∫•u ph·∫©y ho·∫∑c t·ª´ng c√°i):</div>
                    <div class="percentage-input-group">
                        <input type="text" id="percentInput" class="percentage-input" placeholder="V√≠ d·ª•: 14, 27, 6, 9, 5, 26, 22, 25, 7, 14, 24, 11, 23, 4, 37">
                        <button class="tertiary-btn" onclick="addPercentages()">Th√™m</button>
                    </div>
                    
                    <div class="percentage-buttons">
                        <button class="percentage-btn add-btn" onclick="addSinglePercentage()">Th√™m t·ª´ng %</button>
                        <button class="percentage-btn clear-btn" onclick="clearPercentages()">X√≥a t·∫•t c·∫£</button>
                        <button class="percentage-btn preset-btn" onclick="loadPresetPercentages()">M·∫´u c√≥ s·∫µn</button>
                    </div>
                </div>
            </div>
            
            <div class="percentages-display">
                <div class="input-label">C√°c t·ª∑ l·ªá ƒë√£ nh·∫≠p (t·ª± ƒë·ªông lo·∫°i b·ªè tr√πng l·∫∑p):</div>
                <div class="percentages-list" id="percentagesList">
                    <!-- Danh s√°ch ph·∫ßn trƒÉm s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
            </div>
        </div>
        
        <!-- PH√ÇN T√çCH TH·ªêNG K√ä -->
        <div class="percent-analysis-container">
            <div class="percent-analysis-title">
                <span>üìà</span> Ph√¢n T√≠ch T·ª∑ L·ªá Ph·∫ßn TrƒÉm
            </div>
            <div class="percent-stats" id="percentStats">
                <!-- Th·ªëng k√™ ph·∫ßn trƒÉm s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
        </div>
        
        <div class="section-title">
            <span>üîç</span> Ch·ªçn ki·ªÉu t√¨m ki·∫øm
        </div>
        
        <div class="mode-selector">
            <div class="mode-option active" onclick="selectMode('shop')">
                <input type="radio" name="mode" value="shop" checked>
                <span>Theo T√äN SHOP</span>
            </div>
            <div class="mode-option" onclick="selectMode('product')">
                <input type="radio" name="mode" value="product">
                <span>Theo S·∫¢N PH·∫®M / NG√ÄNH</span>
            </div>
        </div>
        
        <div class="commission-filter">
            <div class="input-label">L·ªçc theo t·ª∑ l·ªá hoa h·ªìng:</div>
            <div class="filter-options" id="commissionFilter">
                <!-- C√°c n√∫t l·ªçc s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông -->
            </div>
        </div>
        
        <div class="input-container">
            <label class="input-label">Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm:</label>
            <div class="input-group">
                <input id="searchInput" placeholder="V√≠ d·ª•: BGHouse / m·ªπ ph·∫©m / decor / t√∫i x√°ch">
            </div>
        </div>
        
        <div class="input-container">
            <label class="input-label">Ho·∫∑c nh·∫≠p link CSV tr·ª±c ti·∫øp:</label>
            <div class="url-input-container">
                <div class="input-group">
                    <input id="csvUrlInput" type="text" placeholder="https://example.com/data.csv">
                    <button class="tertiary-btn" onclick="loadCSVFromUrl()">üì• T·∫£i CSV</button>
                </div>
                <div id="urlInfo"></div>
            </div>
        </div>
        
        <div class="input-container">
            <label class="input-label">Ho·∫∑c t·∫£i t·ªáp l√™n t·ª´ m√°y t√≠nh:</label>
            <div class="file-input-container">
                <label class="file-input-label">
                    <input type="file" id="fileInput" accept=".txt,.csv,.json" style="display: none;">
                    <div class="file-input-icon">üìÅ</div>
                    <div class="file-input-text">
                        <strong>Nh·∫•p ƒë·ªÉ ch·ªçn t·ªáp</strong><br>
                        H·ªó tr·ª£ ƒë·ªãnh d·∫°ng: TXT, CSV, JSON
                    </div>
                </label>
            </div>
            <div id="fileInfo"></div>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>ƒêang t·∫£i v√† ph√¢n t√≠ch d·ªØ li·ªáu...</p>
        </div>
        
        <div class="buttons-container">
            <button class="primary-btn" onclick="analyzeData()">
                <span>üöÄ</span> T√åM KI·∫æM NGAY
            </button>
            <button class="secondary-btn" onclick="resetForm()">
                <span>üîÑ</span> L√ÄM M·ªöI
            </button>
        </div>
    </div>
    
    <div id="stats-container" style="display: none;"></div>
    <div class="analysis-section">
    <h2 class="section-title">üìä B·∫£ng Ph√¢n T√≠ch Gi√° & Hoa H·ªìng</h2>
    <div id="priceTableContainer"></div>
</div>

<div class="analysis-section">
    <h2 class="section-title">üìà Bi·ªÉu ƒê·ªì Gi√° Theo %</h2>
    <div id="priceChart"></div>
</div>

    <div id="offers-container"></div>
    
    <script>
        // ================== BI·∫æN TO√ÄN C·ª§C ==================
        let percentages = []; // L∆∞u danh s√°ch ph·∫ßn trƒÉm ƒë√£ nh·∫≠p
        const totalClicks = 106; // T·ªïng s·ªë l∆∞·ª£ng ƒë√£ b√°n
        let shopeeOffers = []; // D·ªØ li·ªáu t·ª´ CSV
        let currentFilter = 'all'; // L∆∞u filter hi·ªán t·∫°i
        
        // ================== QU·∫¢N L√ù PH·∫¶N TRƒÇM ==================
        function addPercentages() {
            const input = document.getElementById('percentInput').value.trim();
            if (!input) {
                alert('Vui l√≤ng nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm');
                return;
            }
            
            // T√°ch c√°c ph·∫ßn trƒÉm b·∫±ng d·∫•u ph·∫©y ho·∫∑c kho·∫£ng tr·∫Øng
            const newPercentages = input.split(/[, ]+/)
                .map(p => {
                    // Lo·∫°i b·ªè k√Ω t·ª± % v√† kho·∫£ng tr·∫Øng
                    let num = p.replace('%', '').trim();
                    // Chuy·ªÉn ƒë·ªïi sang s·ªë
                    return parseFloat(num);
                })
                .filter(p => !isNaN(p) && p > 0 && p <= 100); // Ch·ªâ l·∫•y s·ªë h·ª£p l·ªá
            
            if (newPercentages.length === 0) {
                alert('Kh√¥ng t√¨m th·∫•y s·ªë ph·∫ßn trƒÉm h·ª£p l·ªá. Vui l√≤ng nh·∫≠p s·ªë (v√≠ d·ª•: 14, 27, 6)');
                return;
            }
            
            // Th√™m v√†o m·∫£ng, lo·∫°i b·ªè tr√πng l·∫∑p
            percentages = [...new Set([...percentages, ...newPercentages])].sort((a, b) => a - b);
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            updatePercentagesDisplay();
            
            // X√≥a √¥ nh·∫≠p
            document.getElementById('percentInput').value = '';
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            updatePercentageStats();
        }
        
        function addSinglePercentage() {
            const input = document.getElementById('percentInput').value.trim();
            if (!input) {
                alert('Vui l√≤ng nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm');
                return;
            }
            
            // Ch·ªâ l·∫•y s·ªë ƒë·∫ßu ti√™n
            const num = parseFloat(input.replace('%', '').trim());
            
            if (isNaN(num) || num <= 0 || num > 100) {
                alert('Vui l√≤ng nh·∫≠p s·ªë ph·∫ßn trƒÉm h·ª£p l·ªá (t·ª´ 1 ƒë·∫øn 100)');
                return;
            }
            
            // Th√™m v√†o m·∫£ng, lo·∫°i b·ªè tr√πng l·∫∑p
            percentages = [...new Set([...percentages, num])].sort((a, b) => a - b);
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            updatePercentagesDisplay();
            
            // X√≥a √¥ nh·∫≠p
            document.getElementById('percentInput').value = '';
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            updatePercentageStats();
        }
        
        function loadPresetPercentages() {
            // M·∫´u ph·∫ßn trƒÉm m·∫∑c ƒë·ªãnh (c√≥ th√™m 4%, 37%)
            const preset = [14, 27, 6, 9, 5, 26, 22, 25, 7, 14, 24, 11, 23, 4, 37];
            
            // Th√™m v√†o m·∫£ng, lo·∫°i b·ªè tr√πng l·∫∑p
            percentages = [...new Set([...percentages, ...preset])].sort((a, b) => a - b);
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            updatePercentagesDisplay();
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            updatePercentageStats();
            
            // ƒêi·ªÅn v√†o √¥ nh·∫≠p ƒë·ªÉ ng∆∞·ªùi d√πng th·∫•y
            document.getElementById('percentInput').value = preset.join(', ');
        }
        
        function clearPercentages() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ t·ª∑ l·ªá ph·∫ßn trƒÉm?')) {
                percentages = [];
                updatePercentagesDisplay();
                updatePercentageStats();
                document.getElementById('percentInput').value = '';
            }
        }
        
        function removePercentage(index) {
            percentages.splice(index, 1);
            updatePercentagesDisplay();
            updatePercentageStats();
        }
        
        function updatePercentagesDisplay() {
            const listContainer = document.getElementById('percentagesList');
            
            if (percentages.length === 0) {
                listContainer.innerHTML = '<div style="color: #999; font-style: italic;">Ch∆∞a c√≥ t·ª∑ l·ªá n√†o ƒë∆∞·ª£c nh·∫≠p</div>';
                return;
            }
            
            let html = '';
            percentages.forEach((percent, index) => {
                html += `
                    <div class="percentage-tag">
                        ${percent}%
                        <span class="remove-percent" onclick="removePercentage(${index})">√ó</span>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }
        
        // ================== HI·ªÇN TH·ªä TH·ªêNG K√ä PH·∫¶N TRƒÇM ==================
        function updatePercentageStats() {
            const statsContainer = document.getElementById('percentStats');
            
            if (percentages.length === 0) {
                statsContainer.innerHTML = `
                    <div class="percent-stat-item">
                        <div class="percent-value">0</div>
                        <div class="percent-label">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                        <div class="percent-bar-container">
                            <div class="percent-bar" style="width: 0%"></div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // T√≠nh t·ªïng
            const sum = percentages.reduce((a, b) => a + b, 0);
            
            // T√≠nh s·ªë l·∫ßn xu·∫•t hi·ªán c·ªßa m·ªói gi√° tr·ªã
            const countMap = {};
            percentages.forEach(p => {
                countMap[p] = (countMap[p] || 0) + 1;
            });
            
            // T√≠nh ph·∫ßn trƒÉm c·ªßa m·ªói gi√° tr·ªã
            const percentagesData = Object.keys(countMap).map(key => ({
                value: parseInt(key),
                count: countMap[key],
                percentage: ((countMap[key] / percentages.length) * 100).toFixed(1)
            })).sort((a, b) => b.value - a.value);
            
            let statsHTML = '';
            
            // Hi·ªÉn th·ªã t·ªïng quan
            statsHTML += `
                <div class="percent-stat-item">
                    <div class="percent-value">${percentages.length}</div>
                    <div class="percent-label">S·ªë t·ª∑ l·ªá (ƒë√£ lo·∫°i tr√πng)</div>
                    <div class="percent-bar-container">
                        <div class="percent-bar" style="width: ${Math.min(100, (percentages.length / 50) * 100)}%"></div>
                    </div>
                </div>
                <div class="percent-stat-item">
                    <div class="percent-value">${totalClicks}</div>
                    <div class="percent-label">T·ªïng s·ªë l∆∞·ª£ng ƒë√£ b√°n</div>
                    <div class="percent-bar-container">
                        <div class="percent-bar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="percent-stat-item">
                    <div class="percent-value">${(sum / percentages.length).toFixed(1)}%</div>
                    <div class="percent-label">Trung b√¨nh c√°c t·ª∑ l·ªá</div>
                    <div class="percent-bar-container">
                        <div class="percent-bar" style="width: ${(sum / percentages.length)}%"></div>
                    </div>
                </div>
                <div class="percent-stat-item">
                    <div class="percent-value">${Math.max(...percentages)}%</div>
                    <div class="percent-label">T·ª∑ l·ªá cao nh·∫•t</div>
                    <div class="percent-bar-container">
                        <div class="percent-bar" style="width: ${(Math.max(...percentages) / 100) * 100}%"></div>
                    </div>
                </div>
            `;
            
            // Th√™m c√°c t·ª∑ l·ªá c·ª• th·ªÉ (t·ªëi ƒëa 8 c√°i)
            percentagesData.slice(0, 8).forEach((item, index) => {
                const width = (item.value / Math.max(...percentages)) * 100;
                statsHTML += `
                    <div class="percent-stat-item">
                        <div class="percent-value">${item.value}%</div>
                        <div class="percent-label">${item.count} l·∫ßn (${item.percentage}%)</div>
                        <div class="percent-bar-container">
                            <div class="percent-bar" style="width: ${width}%"></div>
                        </div>
                    </div>
                `;
            });
            
            statsContainer.innerHTML = statsHTML;
            
            // T·∫°o c√°c n√∫t l·ªçc
            createFilterButtons();
        }
        
        function createFilterButtons() {
            const filterContainer = document.getElementById('commissionFilter');
            
            if (percentages.length === 0) {
                filterContainer.innerHTML = '<div style="color: #999;">Vui l√≤ng nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm tr∆∞·ªõc</div>';
                return;
            }
            
            const uniquePercentages = [...new Set(percentages)].sort((a, b) => a - b);
            
            let filterHTML = `
                <div class="filter-option ${currentFilter === 'all' ? 'active' : ''}" onclick="setFilter('all')">
                    T·∫•t c·∫£ (${uniquePercentages.length} t·ª∑ l·ªá)
                </div>
            `;
            
            uniquePercentages.forEach(percent => {
                const count = percentages.filter(p => p === percent).length;
                filterHTML += `
                    <div class="filter-option ${currentFilter === percent.toString() ? 'active' : ''}" onclick="setFilter('${percent}')">
                        ${percent}% (${count})
                    </div>
                `;
            });
            
            filterContainer.innerHTML = filterHTML;
        }
        
        function setFilter(filterValue) {
            currentFilter = filterValue;
            createFilterButtons();
            renderOffers(shopeeOffers);
        }
        
        // ================== H√ÄM PH√ÇN T√çCH CSV ==================
        function parseCSV(csvText) {
            const results = [];
            const lines = csvText.split('\n');
            
            if (lines.length === 0) return results;
            
            // Lo·∫°i b·ªè BOM n·∫øu c√≥
            let firstLine = lines[0];
            if (firstLine.charCodeAt(0) === 0xFEFF) {
                firstLine = firstLine.substring(1);
                lines[0] = firstLine;
            }
            
            // L·∫•y headers
            const headers = parseCSVLine(lines[0]);
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = parseCSVLine(line);
                if (values.length === 0) continue;
                
                const row = {};
                for (let j = 0; j < headers.length; j++) {
                    if (j < values.length) {
                        row[headers[j]] = values[j];
                    } else {
                        row[headers[j]] = '';
                    }
                }
                
                results.push(row);
            }
            
            return results;
        }
        
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = i + 1 < line.length ? line[i + 1] : '';
                
                if (char === '"' && !inQuotes) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes && nextChar === '"') {
                    current += '"';
                    i++; // B·ªè qua d·∫•u nh√°y k√©p ti·∫øp theo
                } else if (char === '"' && inQuotes) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    values.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current);
            return values.map(v => v.trim());
        }
        
        // ================== T·∫¢I CSV T·ª™ URL ==================
        async function loadCSVFromUrl() {
            const url = document.getElementById('csvUrlInput').value.trim();
            const urlInfo = document.getElementById('urlInfo');
            
            if (!url) {
                urlInfo.innerHTML = '<span style="color:red">‚ö†Ô∏è Vui l√≤ng nh·∫≠p URL CSV</span>';
                return;
            }
            
            try {
                document.getElementById('loading').style.display = 'block';
                urlInfo.innerHTML = '‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ URL...';
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('File CSV tr·ªëng');
                }
                
                const csvData = parseCSV(csvText);
                
                if (csvData.length === 0) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu trong CSV');
                }
                
                const offersFromCSV = convertCSVToOffers(csvData);
                
                if (offersFromCSV.length === 0) {
                    throw new Error('Kh√¥ng th·ªÉ chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu CSV');
                }
                
                shopeeOffers = offersFromCSV;
                
                showStats(offersFromCSV.length, true);
                
                urlInfo.innerHTML = `‚úÖ ƒê√£ t·∫£i th√†nh c√¥ng: <strong>${offersFromCSV.length}</strong> m·ª•c t·ª´ CSV`;
                
                renderOffers(shopeeOffers);
                
            } catch (error) {
                console.error("L·ªói t·∫£i CSV t·ª´ URL:", error);
                urlInfo.innerHTML = `<span style="color:red">‚ùå L·ªói: ${error.message}</span>`;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function convertCSVToOffers(csvData) {
            return csvData.map(row => {
                let name = '';
                let commission = '';
                let link = '';
                let category = '';
                let productName = '';
                
                for (const key in row) {
                    const value = row[key];
                    if (value && typeof value === 'string') {
                        if (key.toLowerCase().includes('t√™n') || key.toLowerCase().includes('name')) {
                            if (key.toLowerCase().includes('s·∫£n ph·∫©m')) {
                                productName = value;
                            } else if (key.toLowerCase().includes('c·ª≠a h√†ng') || key.toLowerCase().includes('shop')) {
                                name = value;
                            } else if (!name && !productName) {
                                name = value;
                            }
                        }
                        
                        if (key.toLowerCase().includes('hoa h·ªìng') || 
                            key.toLowerCase().includes('commission') || 
                            key.toLowerCase().includes('t·ªâ l·ªá') ||
                            key.toLowerCase().includes('%')) {
                            commission = extractCommission(value);
                        }
                        
                        if (key.toLowerCase().includes('tracking link') || 
                            key.toLowerCase().includes('tracking') ||
                            key.toLowerCase().includes('∆∞u ƒë√£i') ||
                            key.toLowerCase().includes('link ng·∫Øn')) {
                            link = value;
                        }
                        
                        if (!link && value.includes('shopee')) {
                            link = value;
                        }
                        
                        if (key.toLowerCase().includes('doanh thu') || key.toLowerCase().includes('gi√°')) {
                            category = 'S·∫£n ph·∫©m';
                        }
                    }
                }
                
                if (!name && !productName && Object.keys(row).length > 0) {
                    const firstKey = Object.keys(row)[0];
                    const firstValue = row[firstKey];
                    if (firstValue && typeof firstValue === 'string') {
                        name = firstValue;
                    }
                }
                
                if (!link) {
                    link = 'https://shopee.vn';
                }
                
                const displayName = productName || name || 'Kh√¥ng c√≥ t√™n';
                
                return {
                    name: displayName,
                    commission: commission || '0%',
                    category: category || 'T·ª´ CSV',
                    link: link,
                    originalName: name,
                    productName: productName
                };
            }).filter(offer => offer.name && offer.name !== 'Kh√¥ng c√≥ t√™n');
        }
        
        // ================== H√ÄM X·ª¨ L√ù MODE ==================
        function selectMode(mode) {
            document.querySelectorAll('input[name="mode"]').forEach(radio => {
                radio.checked = (radio.value === mode);
            });
            
            document.querySelectorAll('.mode-option').forEach(option => {
                if (option.querySelector('input').value === mode) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
            
            const input = document.getElementById('searchInput');
            if (mode === 'shop') {
                input.placeholder = "V√≠ d·ª•: BGHouse, Unilever, BJIAX...";
            } else {
                input.placeholder = "V√≠ d·ª•: m·ªπ ph·∫©m, decor, t√∫i x√°ch, gia d·ª•ng...";
            }
        }
        
        // ================== X·ª¨ L√ù T·ªÜP T·∫¢I L√äN ==================
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const fileInfo = document.getElementById('fileInfo');
            
            if (file) {
                fileInfo.innerHTML = `‚úÖ ƒê√£ ch·ªçn: <strong>${file.name}</strong> (${formatFileSize(file.size)})`;
                
                document.getElementById('loading').style.display = 'block';
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    processFileContent(content, file.name);
                };
                
                reader.readAsText(file, 'UTF-8');
            } else {
                fileInfo.innerHTML = "";
            }
        });
        
        function formatFileSize(bytes) {
            if (!bytes) return '0 bytes';
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        function processFileContent(content, fileName) {
            try {
                if (fileName.endsWith('.csv')) {
                    console.log("B·∫Øt ƒë·∫ßu ph√¢n t√≠ch file CSV:", fileName);
                    const csvData = parseCSV(content);
                    console.log("D·ªØ li·ªáu CSV ƒë√£ ph√¢n t√≠ch:", csvData.length, "d√≤ng");
                    
                    if (csvData.length > 0) {
                        const offersFromCSV = convertCSVToOffers(csvData);
                        console.log("ƒê√£ chuy·ªÉn ƒë·ªïi th√†nh:", offersFromCSV.length, "offer");
                        
                        shopeeOffers = offersFromCSV;
                        
                        showStats(offersFromCSV.length, true);
                        
                        document.getElementById('fileInfo').innerHTML += 
                            `<br>üìä ƒê√£ t·∫£i: <strong>${offersFromCSV.length}</strong> m·ª•c t·ª´ file CSV`;
                        
                        renderOffers(shopeeOffers);
                    } else {
                        console.log("CSV r·ªóng ho·∫∑c kh√¥ng c√≥ d·ªØ li·ªáu");
                        document.getElementById('fileInfo').innerHTML += 
                            '<br><span style="color:orange">‚ö†Ô∏è File CSV kh√¥ng c√≥ d·ªØ li·ªáu</span>';
                    }
                } else if (fileName.endsWith('.txt')) {
                    const lines = content.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    if (lines.length > 0) {
                        document.getElementById('searchInput').value = lines[0];
                        document.getElementById('fileInfo').innerHTML += 
                            `<br>üìù T√¨m ki·∫øm theo: <strong>"${lines[0]}"</strong>`;
                    }
                }
            } catch (e) {
                console.error("L·ªói x·ª≠ l√Ω file:", e);
                document.getElementById('fileInfo').innerHTML += 
                    '<br><span style="color:red">‚ùå L·ªói ƒë·ªçc file: ' + e.message + '</span>';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function extractCommission(text) {
            console.log("Tr√≠ch xu·∫•t commission t·ª´:", text);
            
            const match = text.match(/(\d+[.,]?\d*)%/);
            if (match) {
                const num = parseFloat(match[1].replace(',', '.'));
                console.log("T√¨m th·∫•y s·ªë:", num);
                return num + '%';
            }
            
            const numberMatch = text.match(/(\d+[.,]?\d*)/);
            if (numberMatch) {
                const num = parseFloat(numberMatch[1].replace(',', '.'));
                console.log("T√¨m th·∫•y s·ªë (kh√¥ng c√≥ %):", num);
                return num + '%';
            }
            
            console.log("Kh√¥ng t√¨m th·∫•y commission, tr·∫£ v·ªÅ 0%");
            return '0%';
        }
        
        function showStats(totalCount, fromCSV = false) {
            const statsContainer = document.getElementById('stats-container');
            
            const matchingCount = getPercentageMatchCount();
            const averageCommission = calculateAverageCommission();
            
            statsContainer.innerHTML = `
                <div class="stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${totalCount}</div>
                            <div class="stat-label">T·ªïng s·ªë m·ª•c</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${matchingCount}</div>
                            <div class="stat-label">Ph√π h·ª£p t·ª∑ l·ªá %</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${averageCommission}%</div>
                            <div class="stat-label">Hoa h·ªìng TB</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${fromCSV ? 'CSV' : 'G·ªëc'}</div>
                            <div class="stat-label">Ngu·ªìn d·ªØ li·ªáu</div>
                        </div>
                    </div>
                </div>
            `;
            
            statsContainer.style.display = 'block';
        }
        
        function calculateAverageCommission() {
            if (shopeeOffers.length === 0) return 0;
            
            const total = shopeeOffers.reduce((sum, offer) => {
                const commission = parseFloat(offer.commission) || 0;
                return sum + commission;
            }, 0);
            
            return (total / shopeeOffers.length).toFixed(1);
        }
        
        function getPercentageMatchCount() {
            if (percentages.length === 0) return 0;
            
            let count = 0;
            shopeeOffers.forEach(offer => {
                const commission = parseFloat(offer.commission) || 0;
                if (percentages.includes(Math.round(commission))) {
                    count++;
                }
            });
            
            return count;
        }
        
        // ================== HI·ªÇN TH·ªä ==================
        function renderOffers(list) {
            const container = document.getElementById('offers-container');
            
            if (!list || list.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üòï</div>
                        <h3>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p</h3>
                        <p>Th·ª≠ v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c nh·∫≠p link CSV</p>
                    </div>
                `;
                return;
            }
            
            // L·ªçc theo t·ª∑ l·ªá hoa h·ªìng n·∫øu c√≥ filter
            let filteredList = list;
            if (currentFilter !== 'all') {
                const filterPercent = parseInt(currentFilter);
                filteredList = list.filter(offer => {
                    const commission = parseFloat(offer.commission) || 0;
                    return Math.round(commission) === filterPercent;
                });
            }
            
            // L·ªçc ch·ªâ hi·ªÉn th·ªã c√°c m·ª•c c√≥ hoa h·ªìng t·ª´ danh s√°ch ph·∫ßn trƒÉm
            if (percentages.length > 0) {
                filteredList = filteredList.filter(offer => {
                    const commission = parseFloat(offer.commission) || 0;
                    return percentages.includes(Math.round(commission));
                });
            }
            
            if (filteredList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>Kh√¥ng t√¨m th·∫•y m·ª•c ph√π h·ª£p</h3>
                        ${percentages.length === 0 ? 
                            '<p>Vui l√≤ng nh·∫≠p t·ª∑ l·ªá ph·∫ßn trƒÉm ƒë·ªÉ l·ªçc d·ªØ li·ªáu</p>' : 
                            `<p>Ti√™u ch√≠ ph·∫ßn trƒÉm: ${percentages.sort((a,b)=>a-b).join('%, ')}%</p>`}
                        <p>T·ªïng s·ªë l∆∞·ª£ng ƒë√£ b√°n: ${totalClicks}</p>
                        ${currentFilter !== 'all' ? `<p>ƒêang l·ªçc: ${currentFilter}%</p>` : ''}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            // S·∫Øp x·∫øp theo hoa h·ªìng gi·∫£m d·∫ßn
            filteredList.sort((a, b) => {
                const aCommission = parseFloat(a.commission) || 0;
                const bCommission = parseFloat(b.commission) || 0;
                return bCommission - aCommission;
            });
            
            filteredList.forEach(offer => {
                if (!offer || !offer.name) return;
                
                const card = document.createElement('div');
                card.className = 'offer-card';
                card.innerHTML = `
                    <h3>${offer.name}</h3>
                    <p class="commission">üí∞ Hoa h·ªìng: ${offer.commission || '0%'}</p>
                    <p class="category">üì¶ Ngu·ªìn: ${offer.category || 'Kh√¥ng x√°c ƒë·ªãnh'}</p>
                    ${offer.originalName ? `<p><small>Shop: ${offer.originalName}</small></p>` : ''}
                    <div class="links">
                        <a class="primary-link" href="${offer.link || '#'}" target="_blank">Link Affiliate</a>
                        <a class="secondary-link" href="${offer.link || '#'}" target="_blank">Xem chi ti·∫øt</a>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // ================== PH√ÇN T√çCH ==================
        function analyzeData() {
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!keyword && shopeeOffers.length === 0) {
                alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p t·ª´ kh√≥a ho·∫∑c t·∫£i d·ªØ li·ªáu CSV");
                return;
            }
            
            const mode = document.querySelector('input[name="mode"]:checked').value;
            let result = [];
            
            if (keyword) {
                if (mode === "shop") {
                    result = shopeeOffers.filter(o => 
                        o && (o.name && o.name.toLowerCase().includes(keyword) ||
                             o.originalName && o.originalName.toLowerCase().includes(keyword))
                    );
                } else {
                    result = shopeeOffers.filter(o => 
                        o && o.category && o.category.toLowerCase().includes(keyword)
                    );
                }
            } else {
                result = [...shopeeOffers];
            }
            
            renderOffers(result);renderPriceTable();
renderPriceChart();
renderBestPercentSuggestion();

        }
		
        
        // ================== L√ÄM M·ªöI FORM ==================
        function resetForm() {
            document.getElementById('searchInput').value = '';
            document.getElementById('csvUrlInput').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').innerHTML = '';
            document.getElementById('urlInfo').innerHTML = '';
            document.getElementById('percentInput').value = '';
            document.getElementById('stats-container').style.display = 'none';
            currentFilter = 'all';
            
            // Kh√¥ng reset ph·∫ßn trƒÉm ƒë√£ nh·∫≠p
            // Ch·ªâ reset d·ªØ li·ªáu CSV
            shopeeOffers = [];
            
            renderOffers(shopeeOffers);
            createFilterButtons();
        }
        
        // ================== KH·ªûI T·∫†O BAN ƒê·∫¶U ==================
        document.addEventListener('DOMContentLoaded', function() {
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ph·∫ßn trƒÉm
            updatePercentagesDisplay();
            updatePercentageStats();
            
            // Hi·ªÉn th·ªã tr·∫°ng th√°i ban ƒë·∫ßu
            renderOffers(shopeeOffers);
            
            // Th√™m hi·ªáu ·ª©ng focus cho √¥ input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('focus', function() {
                    this.style.borderColor = '#ff5722';
                    this.style.boxShadow = '0 0 0 3px rgba(255, 87, 34, 0.2)';
                });
                
                searchInput.addEventListener('blur', function() {
                    this.style.borderColor = '#ddd';
                    this.style.boxShadow = 'none';
                });
                
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        analyzeData();
                    }
                });
            }
            
            // Th√™m s·ª± ki·ªán Enter cho √¥ URL CSV
            const csvUrlInput = document.getElementById('csvUrlInput');
            if (csvUrlInput) {
                csvUrlInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loadCSVFromUrl();
                    }
                });
            }
            
            // Th√™m s·ª± ki·ªán Enter cho √¥ nh·∫≠p ph·∫ßn trƒÉm
            const percentInput = document.getElementById('percentInput');
            if (percentInput) {
                percentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addPercentages();
                    }
                });
            }
        });
		function calculatePriceRange(percent, sold) {
    const base = Math.pow(percent, 2) + sold;
    return {
        base,
        min: Math.round(base * 0.95),
        max: Math.round(base * 1.05)
    };
}
function renderPriceTable() {
    const sold = parseInt(document.getElementById('soldInput')?.value) || 0;
    const box = document.getElementById('priceTableContainer');

    if (!sold || percentages.length === 0) {
        box.innerHTML = '<i>Nh·∫≠p % v√† s·ªë l∆∞·ª£ng b√°n ƒë·ªÉ xem b·∫£ng</i>';
        return;
    }

    let html = `
    <table style="width:100%;border-collapse:collapse">
        <tr style="background:#ff5722;color:#fff">
            <th>%</th><th>S·ªë b√°n</th><th>Gi√° g·ªëc</th><th>Gi√° ¬±5%</th><th>Hoa h·ªìng</th>
        </tr>`;

    percentages.forEach(p => {
        const price = calculatePriceRange(p, sold);
        const avg = (price.min + price.max) / 2;
        const commission = Math.round(avg * p / 100);

        html += `
        <tr style="text-align:center">
            <td>${p}%</td>
            <td>${sold}</td>
            <td>${price.base}</td>
            <td>${price.min} ‚Äì ${price.max}</td>
            <td style="color:green"><b>${commission}</b></td>
        </tr>`;
    });

    html += '</table>';
    box.innerHTML = html;
}
function renderPriceChart() {
    const sold = parseInt(document.getElementById('soldInput')?.value) || 0;
    const chart = document.getElementById('priceChart');

    if (!sold || percentages.length === 0) {
        chart.innerHTML = '';
        return;
    }

    const max = Math.max(...percentages.map(p => Math.pow(p,2)+sold));

    chart.innerHTML = percentages.map(p => {
        const v = Math.pow(p,2)+sold;
        return `
        <div style="margin-bottom:8px">
            <b>${p}%</b>
            <div style="background:#eee;border-radius:6px">
                <div style="width:${(v/max)*100}%;background:#4caf50;color:#fff;padding-left:6px">
                    ${v}
                </div>
            </div>
        </div>`;
    }).join('');
}
function renderBestPercentSuggestion() {
    const sold = parseInt(document.getElementById('soldInput')?.value) || 0;
    if (!sold || percentages.length === 0) return;

    let best = {p:0, v:0};

    percentages.forEach(p => {
        const price = calculatePriceRange(p, sold);
        const avg = (price.min + price.max) / 2;
        const com = avg * p / 100;
        if (com > best.v) best = {p, v: com};
    });

    alert(`üöÄ N√™n ∆∞u ti√™n ${best.p}% ‚Äì Hoa h·ªìng cao nh·∫•t ~ ${Math.round(best.v)}`);
}

    </script>
</body>
</html>
